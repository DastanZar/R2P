<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>R2P ‚Äî Resume to Portfolio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }

    /* Custom scrollbar */
    pre::-webkit-scrollbar { width: 8px; height: 8px; }
    pre::-webkit-scrollbar-track { background: #1e293b; border-radius: 4px; }
    pre::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    pre::-webkit-scrollbar-thumb:hover { background: #64748b; }

    /* Spinner animation */
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner {
      width: 20px; height: 20px;
      border: 2.5px solid #e2e8f0;
      border-top-color: #6366f1;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }
    .spinner-lg {
      width: 40px; height: 40px;
      border: 3px solid #334155;
      border-top-color: #818cf8;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    /* JSON syntax highlighting */
    .json-key { color: #93c5fd; }
    .json-string { color: #86efac; }
    .json-number { color: #fde68a; }
    .json-boolean { color: #f9a8d4; }
    .json-null { color: #a5b4fc; }
    .json-bracket { color: #cbd5e1; }

    /* Drag-and-drop zone */
    .drop-zone {
      border: 2px dashed #374151;
      transition: all 0.3s ease;
    }
    .drop-zone:hover, .drop-zone.drag-over {
      border-color: #818cf8;
      background: rgba(99, 102, 241, 0.05);
    }
    .drop-zone.drag-over {
      transform: scale(1.01);
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.1);
    }

    /* Fade-in animation */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in-up {
      animation: fadeInUp 0.5s ease-out forwards;
    }

    /* Progress bar animation */
    @keyframes progressPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    .progress-pulse {
      animation: progressPulse 1.5s ease-in-out infinite;
    }

    /* Tab styles */
    .tab-btn {
      transition: all 0.2s ease;
    }
    .tab-btn.active {
      color: #818cf8;
      border-color: #818cf8;
    }
    .tab-btn:not(.active) {
      color: #6b7280;
      border-color: transparent;
    }
    .tab-btn:not(.active):hover {
      color: #9ca3af;
    }

    /* Card hover effect */
    .card-hover {
      transition: all 0.2s ease;
    }
    .card-hover:hover {
      border-color: #4b5563;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    /* Score ring */
    .score-ring {
      transform: rotate(-90deg);
    }
    .score-ring circle {
      transition: stroke-dashoffset 1s ease-out;
    }
  </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen">

  <!-- ===== HEADER ===== -->
  <header class="border-b border-gray-800/50 bg-gray-950/80 backdrop-blur-xl sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
          <span class="text-white font-bold text-sm">R2P</span>
        </div>
        <div>
          <h1 class="text-lg font-bold tracking-tight text-white">Resume to Portfolio</h1>
          <p class="text-xs text-gray-500 hidden sm:block">Upload your resume, get a portfolio</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <span class="text-xs text-gray-600 hidden sm:inline">Phase 3A</span>
        <button id="settingsToggle" class="text-gray-500 hover:text-gray-300 transition-colors p-2 rounded-lg hover:bg-gray-800/50" title="Settings">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 010 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 010-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28z"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- ===== SETTINGS PANEL (collapsible) ===== -->
  <div id="settingsPanel" class="hidden border-b border-gray-800/50 bg-gray-900/50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4">
      <div class="flex items-center gap-3">
        <label for="apiKey" class="text-sm font-medium text-gray-400 whitespace-nowrap">
          OpenAI API Key
        </label>
        <input
          id="apiKey"
          type="password"
          placeholder="sk-... (optional ‚Äî enables LLM extraction)"
          class="flex-1 bg-gray-800/50 border border-gray-700/50 rounded-lg px-4 py-2 text-sm text-gray-200 placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent"
        />
        <button
          id="toggleKey"
          class="text-xs text-gray-500 hover:text-gray-300 px-2 py-2 rounded transition-colors"
          title="Show / hide key"
        >Show</button>
      </div>
      <p id="modeIndicator" class="mt-2 text-xs text-gray-600">
        Mode: <span class="text-amber-400/80 font-medium">Regex/Heuristic fallback</span> ‚Äî paste an API key to use GPT extraction.
      </p>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-8">

    <!-- ===== UPLOAD SECTION ===== -->
    <section id="uploadSection" class="fade-in-up">
      <!-- Hero text -->
      <div class="text-center mb-8">
        <h2 class="text-3xl sm:text-4xl font-bold text-white mb-3">
          Transform your resume into a <span class="text-indigo-400">portfolio</span>
        </h2>
        <p class="text-gray-500 text-lg max-w-2xl mx-auto">
          Upload a PDF or paste your resume text. We'll extract the data and generate a beautiful portfolio site.
        </p>
      </div>

      <!-- Input tabs -->
      <div class="flex justify-center mb-6">
        <div class="inline-flex border-b border-gray-800">
          <button id="tabPdf" class="tab-btn active px-6 py-3 text-sm font-medium border-b-2 transition-colors">
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
              </svg>
              Upload PDF
            </span>
          </button>
          <button id="tabText" class="tab-btn px-6 py-3 text-sm font-medium border-b-2 transition-colors">
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              Paste Text
            </span>
          </button>
        </div>
      </div>

      <!-- PDF Upload Panel -->
      <div id="pdfPanel" class="max-w-2xl mx-auto">
        <div
          id="dropZone"
          class="drop-zone rounded-2xl p-12 text-center cursor-pointer bg-gray-900/30"
          role="button"
          tabindex="0"
          aria-label="Upload PDF resume"
        >
          <input type="file" id="fileInput" accept=".pdf" class="hidden" />
          <div id="dropZoneContent">
            <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-indigo-600/10 flex items-center justify-center">
              <svg class="w-8 h-8 text-indigo-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"/>
              </svg>
            </div>
            <p class="text-lg font-medium text-white mb-1">Drop your PDF resume here</p>
            <p class="text-sm text-gray-500 mb-4">or click to browse files</p>
            <span class="inline-flex items-center gap-1.5 text-xs text-gray-600 bg-gray-800/50 px-3 py-1.5 rounded-full">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"/>
              </svg>
              PDF files up to 10MB ¬∑ Text extracted server-side
            </span>
          </div>
          <!-- File selected state -->
          <div id="fileSelectedState" class="hidden">
            <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-green-600/10 flex items-center justify-center">
              <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <p id="selectedFileName" class="text-lg font-medium text-white mb-1"></p>
            <p class="text-sm text-gray-500 mb-4">Ready to process</p>
            <button id="clearFileBtn" class="text-xs text-gray-500 hover:text-gray-300 underline transition-colors">Choose a different file</button>
          </div>
        </div>

        <!-- Upload / Extract button for PDF -->
        <div class="flex justify-center mt-5">
          <button
            id="uploadBtn"
            class="bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 text-white font-medium px-8 py-3 rounded-xl text-sm transition-all flex items-center gap-2 disabled:opacity-40 disabled:cursor-not-allowed shadow-lg shadow-indigo-600/20 hover:shadow-indigo-600/30"
            disabled
          >
            <span id="uploadLabel">Upload & Extract</span>
            <div id="uploadSpinner" class="spinner hidden"></div>
          </button>
        </div>
      </div>

      <!-- PDF Text Preview Panel -->
      <div id="pdfPreviewPanel" class="hidden max-w-2xl mx-auto mt-6">
        <div class="bg-gray-900/30 rounded-2xl border border-gray-800/50 p-6">
          <label class="text-sm font-medium text-gray-300 mb-3 block">Your resume text ‚Äî edit if needed, then click Extract</label>
          <textarea
            id="pdfPreviewText"
            rows="12"
            class="w-full bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-3 text-sm text-gray-200 placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent resize-y"
          ></textarea>
          
          <!-- AI Extraction Option (only if API key present) -->
          <div id="aiExtractOption" class="hidden mt-4 flex items-center gap-2">
            <input type="checkbox" id="useAIExtract" checked class="w-4 h-4 rounded border-gray-600 bg-gray-700 text-indigo-600 focus:ring-indigo-500/50">
            <label for="useAIExtract" class="text-sm text-gray-400">Use AI extraction (more accurate)</label>
          </div>
          
          <div class="flex justify-end mt-4">
            <button
              id="extractFromPreviewBtn"
              class="bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 text-white font-medium px-8 py-3 rounded-xl text-sm transition-all flex items-center gap-2 shadow-lg shadow-indigo-600/20"
            >
              <span>Extract JSON from this text ‚Üí</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Text Paste Panel -->
      <div id="textPanel" class="hidden max-w-2xl mx-auto">
        <div class="bg-gray-900/30 rounded-2xl border border-gray-800/50 p-6">
          <textarea
            id="resumeText"
            rows="14"
            placeholder="John Doe&#10;Software Engineer&#10;john@example.com | (555) 123-4567&#10;linkedin.com/in/johndoe | github.com/johndoe&#10;San Francisco, CA&#10;&#10;SUMMARY&#10;Experienced software engineer with 5+ years...&#10;&#10;EXPERIENCE&#10;Senior Developer ‚Äî Acme Corp (Jan 2021 ‚Äì Present)&#10;‚Ä¢ Led migration of monolith to microservices&#10;‚Ä¢ Reduced API latency by 40%&#10;..."
            class="w-full bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-3 text-sm text-gray-200 placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent resize-y"
          ></textarea>
          <div class="flex justify-end mt-4">
            <button
              id="extractBtn"
              class="bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 text-white font-medium px-8 py-3 rounded-xl text-sm transition-all flex items-center gap-2 disabled:opacity-40 disabled:cursor-not-allowed shadow-lg shadow-indigo-600/20"
            >
              <span id="extractLabel">Extract JSON</span>
              <div id="extractSpinner" class="spinner hidden"></div>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== PROCESSING OVERLAY ===== -->
    <div id="processingOverlay" class="hidden fixed inset-0 bg-gray-950/80 backdrop-blur-sm z-40 flex items-center justify-center">
      <div class="bg-gray-900 rounded-2xl border border-gray-800 p-8 max-w-sm w-full mx-4 text-center">
        <div class="spinner-lg mx-auto mb-5"></div>
        <h3 id="processingTitle" class="text-lg font-semibold text-white mb-2">Processing your resume...</h3>
        <p id="processingSubtitle" class="text-sm text-gray-500">Extracting text from PDF</p>
        <div class="mt-5 w-full bg-gray-800 rounded-full h-1.5 overflow-hidden">
          <div id="processingBar" class="h-full bg-indigo-500 rounded-full transition-all duration-500 progress-pulse" style="width: 30%"></div>
        </div>
      </div>
    </div>

    <!-- ===== STATUS MESSAGE ===== -->
    <div id="statusMsg" class="hidden text-sm rounded-xl px-4 py-3 max-w-2xl mx-auto mt-4"></div>

    <!-- ===== RESULTS DASHBOARD ===== -->
    <section id="dashboardSection" class="hidden mt-10 space-y-8 fade-in-up">

      <!-- Dashboard Header -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h2 class="text-2xl font-bold text-white">Resume Analysis</h2>
          <p id="dashboardSubtitle" class="text-sm text-gray-500 mt-1">Extracted data from your resume</p>
        </div>
        <div class="flex gap-2">
          <button id="newUploadBtn" class="text-sm bg-gray-800 hover:bg-gray-700 text-gray-300 px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
            </svg>
            New Upload
          </button>
        </div>
      </div>

      <!-- Summary Cards Row -->
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
        <div class="bg-gray-900/50 border border-gray-800/50 rounded-xl p-4 card-hover">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-8 h-8 rounded-lg bg-blue-600/10 flex items-center justify-center">
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 013.413-.387m7.5 0V5.25A2.25 2.25 0 0013.5 3h-3a2.25 2.25 0 00-2.25 2.25v.894m7.5 0a48.667 48.667 0 00-7.5 0"/>
              </svg>
            </div>
            <span class="text-xs text-gray-500 font-medium">Experience</span>
          </div>
          <p id="statExperience" class="text-2xl font-bold text-white">0</p>
          <p class="text-xs text-gray-600">positions</p>
        </div>
        <div class="bg-gray-900/50 border border-gray-800/50 rounded-xl p-4 card-hover">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-8 h-8 rounded-lg bg-green-600/10 flex items-center justify-center">
              <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
              </svg>
            </div>
            <span class="text-xs text-gray-500 font-medium">Skills</span>
          </div>
          <p id="statSkills" class="text-2xl font-bold text-white">0</p>
          <p class="text-xs text-gray-600">identified</p>
        </div>
        <div class="bg-gray-900/50 border border-gray-800/50 rounded-xl p-4 card-hover">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-8 h-8 rounded-lg bg-purple-600/10 flex items-center justify-center">
              <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 00-.491 6.347A48.62 48.62 0 0112 20.904a48.62 48.62 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.636 50.636 0 00-2.658-.813A59.906 59.906 0 0112 3.493a59.903 59.903 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0112 13.489a50.702 50.702 0 017.74-3.342"/>
              </svg>
            </div>
            <span class="text-xs text-gray-500 font-medium">Education</span>
          </div>
          <p id="statEducation" class="text-2xl font-bold text-white">0</p>
          <p class="text-xs text-gray-600">degrees</p>
        </div>
        <div class="bg-gray-900/50 border border-gray-800/50 rounded-xl p-4 card-hover">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-8 h-8 rounded-lg bg-amber-600/10 flex items-center justify-center">
              <svg class="w-4 h-4 text-amber-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5"/>
              </svg>
            </div>
            <span class="text-xs text-gray-500 font-medium">Projects</span>
          </div>
          <p id="statProjects" class="text-2xl font-bold text-white">0</p>
          <p class="text-xs text-gray-600">listed</p>
        </div>
      </div>

      <!-- Personal Info Card -->
      <div id="personalCard" class="bg-gray-900/50 border border-gray-800/50 rounded-xl p-6 card-hover">
        <div class="flex items-start gap-4">
          <div class="w-14 h-14 rounded-xl bg-indigo-600/20 flex items-center justify-center flex-shrink-0">
            <span id="personalInitials" class="text-xl font-bold text-indigo-400">?</span>
          </div>
          <div class="flex-1 min-w-0">
            <h3 id="personalName" class="text-xl font-bold text-white truncate">‚Äî</h3>
            <p id="personalTitle" class="text-sm text-indigo-400 mb-2">‚Äî</p>
            <div id="personalDetails" class="flex flex-wrap gap-3 text-xs text-gray-500">
            </div>
          </div>
        </div>
        <div id="summaryBlock" class="hidden mt-4 pt-4 border-t border-gray-800/50">
          <p id="summaryText" class="text-sm text-gray-400 leading-relaxed"></p>
        </div>
      </div>

      <!-- Experience & Skills Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Experience Column -->
        <div class="lg:col-span-2 space-y-4">
          <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">Experience</h3>
          <div id="experienceList" class="space-y-3">
            <p class="text-sm text-gray-600">No experience data found.</p>
          </div>
        </div>
        <!-- Skills Column -->
        <div class="space-y-4">
          <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">Skills</h3>
          <div id="skillsList" class="flex flex-wrap gap-2">
            <p class="text-sm text-gray-600">No skills found.</p>
          </div>

          <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mt-6">Education</h3>
          <div id="educationList" class="space-y-3">
            <p class="text-sm text-gray-600">No education data found.</p>
          </div>
        </div>
      </div>

      <!-- Projects Grid -->
      <div id="projectsBlock" class="hidden">
        <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4">Projects</h3>
        <div id="projectsList" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
      </div>

      <!-- JSON Output (collapsible) -->
      <div class="bg-gray-900/50 border border-gray-800/50 rounded-xl overflow-hidden">
        <button id="jsonToggle" class="w-full flex items-center justify-between px-5 py-3 hover:bg-gray-800/30 transition-colors">
          <span class="text-sm font-medium text-gray-400">Raw JSON Output</span>
          <div class="flex items-center gap-2">
            <button id="copyBtn" class="text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 px-3 py-1.5 rounded-md transition-colors" onclick="event.stopPropagation()">
              üìã Copy
            </button>
            <button id="downloadBtn" class="text-xs bg-gray-800 hover:bg-gray-700 text-gray-400 px-3 py-1.5 rounded-md transition-colors" onclick="event.stopPropagation()">
              ‚¨á Download
            </button>
            <svg id="jsonChevron" class="w-4 h-4 text-gray-500 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
            </svg>
          </div>
        </button>
        <div id="jsonPanel" class="hidden">
          <pre id="jsonOutput" class="p-5 text-sm leading-relaxed overflow-x-auto bg-gray-950/50 max-h-[500px] overflow-y-auto border-t border-gray-800/50"></pre>
        </div>
      </div>

      <!-- ===== PHASE 2: PORTFOLIO GENERATOR ===== -->
      <section id="portfolioSection" class="space-y-6">
        <!-- Generate Portfolio CTA -->
        <div class="bg-gradient-to-r from-indigo-900/20 to-purple-900/20 rounded-xl p-6 border border-indigo-800/30 text-center">
          <h2 class="text-lg font-semibold text-white mb-2">üöÄ Ready to generate your portfolio?</h2>
          <p class="text-sm text-gray-500 mb-4">Turn the extracted data into a beautiful single-page portfolio website.</p>
          <button
            id="openGeneratorBtn"
            class="bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 text-white font-medium px-6 py-2.5 rounded-xl text-sm transition-all shadow-lg shadow-indigo-600/20"
          >
            Generate Portfolio
          </button>
        </div>

        <!-- Generator Options Panel -->
        <div id="generatorPanel" class="hidden bg-gray-900/50 rounded-xl p-6 border border-gray-800/50 space-y-5">
          <h3 class="text-sm font-medium text-gray-300">Choose a Template</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="relative cursor-pointer">
              <input type="radio" name="template" value="minimalist" checked class="peer sr-only" />
              <div class="border-2 border-gray-700 peer-checked:border-indigo-500 rounded-xl p-4 transition-colors">
                <div class="flex items-center gap-3">
                  <span class="text-2xl">üñ§</span>
                  <div>
                    <p class="text-sm font-medium text-white">Minimalist</p>
                    <p class="text-xs text-gray-500">Dark, clean, modern ‚Äî Inter font, smooth animations</p>
                  </div>
                </div>
              </div>
            </label>
          </div>
          <div class="flex justify-end">
            <button
              id="generateWebsiteBtn"
              class="bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 text-white font-medium px-6 py-2.5 rounded-xl text-sm transition-all flex items-center gap-2 shadow-lg shadow-indigo-600/20"
            >
              <span id="genLabel">Generate Website</span>
              <div id="genSpinner" class="spinner hidden"></div>
            </button>
          </div>
        </div>

        <!-- Preview & Download -->
        <div id="previewPanel" class="hidden space-y-4">
          <div class="flex items-center justify-between">
            <h3 class="text-sm font-medium text-gray-300">Portfolio Preview</h3>
            <button
              id="downloadPortfolioBtn"
              class="bg-green-600 hover:bg-green-500 active:bg-green-700 text-white font-medium px-5 py-2 rounded-xl text-sm transition-all shadow-lg shadow-green-600/20"
            >
              ‚¨á Download Portfolio HTML
            </button>
          </div>
          <div class="rounded-xl overflow-hidden border border-gray-700/50 bg-white">
            <iframe id="portfolioPreview" class="w-full" style="height:600px;" sandbox="allow-scripts"></iframe>
          </div>
        </div>
      </section>

    </section>

  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="text-center text-xs text-gray-700 py-8 border-t border-gray-800/30 mt-12">
    R2P ‚Äî Resume to Portfolio &middot; Phase 3A &middot; No data leaves your browser (unless using LLM mode or PDF upload)
  </footer>

  <!-- ================================================================== -->
  <!-- ===== JAVASCRIPT ===== -->
  <!-- ================================================================== -->
  <script>
  (function () {
    "use strict";

    // Configure pdf.js worker for client-side PDF extraction
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }

    // ----- DOM refs -----
    const apiKeyInput    = document.getElementById("apiKey");
    const toggleKeyBtn   = document.getElementById("toggleKey");
    const modeIndicator  = document.getElementById("modeIndicator");
    const settingsToggle = document.getElementById("settingsToggle");
    const settingsPanel  = document.getElementById("settingsPanel");
    const resumeTextarea = document.getElementById("resumeText");
    const extractBtn     = document.getElementById("extractBtn");
    const extractLabel   = document.getElementById("extractLabel");
    const extractSpinner = document.getElementById("extractSpinner");
    const statusMsg      = document.getElementById("statusMsg");
    const jsonOutput     = document.getElementById("jsonOutput");
    const copyBtn        = document.getElementById("copyBtn");
    const downloadBtn    = document.getElementById("downloadBtn");

    // Upload DOM refs
    const tabPdf         = document.getElementById("tabPdf");
    const tabText        = document.getElementById("tabText");
    const pdfPanel       = document.getElementById("pdfPanel");
    const textPanel      = document.getElementById("textPanel");
    const dropZone       = document.getElementById("dropZone");
    const fileInput      = document.getElementById("fileInput");
    const dropZoneContent = document.getElementById("dropZoneContent");
    const fileSelectedState = document.getElementById("fileSelectedState");
    const selectedFileName = document.getElementById("selectedFileName");
    const clearFileBtn   = document.getElementById("clearFileBtn");
    const uploadBtn      = document.getElementById("uploadBtn");
    const uploadLabel    = document.getElementById("uploadLabel");
    const uploadSpinner  = document.getElementById("uploadSpinner");

    // Processing overlay
    const processingOverlay = document.getElementById("processingOverlay");
    const processingTitle   = document.getElementById("processingTitle");
    const processingSubtitle = document.getElementById("processingSubtitle");
    const processingBar     = document.getElementById("processingBar");

    // PDF Preview DOM refs
    const pdfPreviewPanel = document.getElementById("pdfPreviewPanel");
    const pdfPreviewText = document.getElementById("pdfPreviewText");
    const extractFromPreviewBtn = document.getElementById("extractFromPreviewBtn");
    const aiExtractOption = document.getElementById("aiExtractOption");
    const useAIExtract = document.getElementById("useAIExtract");

    // Dashboard DOM refs
    const uploadSection    = document.getElementById("uploadSection");
    const dashboardSection = document.getElementById("dashboardSection");
    const dashboardSubtitle = document.getElementById("dashboardSubtitle");
    const newUploadBtn     = document.getElementById("newUploadBtn");
    const jsonToggle       = document.getElementById("jsonToggle");
    const jsonPanel        = document.getElementById("jsonPanel");
    const jsonChevron      = document.getElementById("jsonChevron");

    // Stats
    const statExperience = document.getElementById("statExperience");
    const statSkills     = document.getElementById("statSkills");
    const statEducation  = document.getElementById("statEducation");
    const statProjects   = document.getElementById("statProjects");

    // Personal card
    const personalInitials = document.getElementById("personalInitials");
    const personalName     = document.getElementById("personalName");
    const personalTitle    = document.getElementById("personalTitle");
    const personalDetails  = document.getElementById("personalDetails");
    const summaryBlock     = document.getElementById("summaryBlock");
    const summaryText      = document.getElementById("summaryText");

    // Lists
    const experienceList = document.getElementById("experienceList");
    const skillsList     = document.getElementById("skillsList");
    const educationList  = document.getElementById("educationList");
    const projectsBlock  = document.getElementById("projectsBlock");
    const projectsList   = document.getElementById("projectsList");

    // Phase 2 DOM refs
    const portfolioSection     = document.getElementById("portfolioSection");
    const openGeneratorBtn     = document.getElementById("openGeneratorBtn");
    const generatorPanel       = document.getElementById("generatorPanel");
    const generateWebsiteBtn   = document.getElementById("generateWebsiteBtn");
    const genLabel             = document.getElementById("genLabel");
    const genSpinner           = document.getElementById("genSpinner");
    const previewPanel         = document.getElementById("previewPanel");
    const portfolioPreview     = document.getElementById("portfolioPreview");
    const downloadPortfolioBtn = document.getElementById("downloadPortfolioBtn");

    let extractedJSON = null;
    let generatedHTML = null;
    let selectedFile  = null;

    // ----- Settings toggle -----
    settingsToggle.addEventListener("click", () => {
      settingsPanel.classList.toggle("hidden");
    });

    // ----- API key persistence (sessionStorage) -----
    const STORAGE_KEY = "r2p_openai_key";
    const savedKey = sessionStorage.getItem(STORAGE_KEY);
    if (savedKey) {
      apiKeyInput.value = savedKey;
      updateModeIndicator();
    }

    apiKeyInput.addEventListener("input", () => {
      const key = apiKeyInput.value.trim();
      if (key) sessionStorage.setItem(STORAGE_KEY, key);
      else sessionStorage.removeItem(STORAGE_KEY);
      updateModeIndicator();
    });

    function updateModeIndicator() {
      const hasKey = apiKeyInput.value.trim().length > 0;
      modeIndicator.innerHTML = hasKey
        ? 'Mode: <span class="text-green-400 font-medium">LLM (OpenAI GPT-3.5-turbo)</span>'
        : 'Mode: <span class="text-amber-400/80 font-medium">Regex/Heuristic fallback</span> ‚Äî paste an API key to use GPT extraction.';
    }

    // ----- Toggle key visibility -----
    toggleKeyBtn.addEventListener("click", () => {
      const isPassword = apiKeyInput.type === "password";
      apiKeyInput.type = isPassword ? "text" : "password";
      toggleKeyBtn.textContent = isPassword ? "Hide" : "Show";
    });

    // ================================================================
    // TAB SWITCHING
    // ================================================================
    tabPdf.addEventListener("click", () => {
      tabPdf.classList.add("active");
      tabText.classList.remove("active");
      pdfPanel.classList.remove("hidden");
      textPanel.classList.add("hidden");
    });

    tabText.addEventListener("click", () => {
      tabText.classList.add("active");
      tabPdf.classList.remove("active");
      textPanel.classList.remove("hidden");
      pdfPanel.classList.add("hidden");
    });

    // ================================================================
    // DRAG AND DROP / FILE UPLOAD
    // ================================================================
    dropZone.addEventListener("click", () => fileInput.click());
    dropZone.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); fileInput.click(); }
    });

    ["dragenter", "dragover"].forEach(evt => {
      dropZone.addEventListener(evt, (e) => {
        e.preventDefault();
        dropZone.classList.add("drag-over");
      });
    });

    ["dragleave", "drop"].forEach(evt => {
      dropZone.addEventListener(evt, (e) => {
        e.preventDefault();
        dropZone.classList.remove("drag-over");
      });
    });

    dropZone.addEventListener("drop", (e) => {
      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type === "application/pdf") {
        handleFileSelection(files[0]);
      } else {
        showStatus("error", "Please drop a PDF file.");
      }
    });

    fileInput.addEventListener("change", () => {
      if (fileInput.files.length > 0) {
        handleFileSelection(fileInput.files[0]);
      }
    });

    clearFileBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      clearFileSelection();
    });

    function handleFileSelection(file) {
      selectedFile = file;
      selectedFileName.textContent = file.name;
      dropZoneContent.classList.add("hidden");
      fileSelectedState.classList.remove("hidden");
      uploadBtn.disabled = false;
      hideStatus();
    }

    function clearFileSelection() {
      selectedFile = null;
      fileInput.value = "";
      dropZoneContent.classList.remove("hidden");
      fileSelectedState.classList.add("hidden");
      uploadBtn.disabled = true;
    }

    // ================================================================
    // PDF UPLOAD - Simple extraction with editable preview
    // ================================================================
    uploadBtn.addEventListener("click", async () => {
      if (!selectedFile) return;

      hideStatus();
      hidePDFPreview();
      setLoading(true);
      uploadLabel.textContent = "Extracting text...";

      try {
        // Simple text extraction - just join all text items with spaces
        const rawText = await extractRawTextFromPDF(selectedFile);
        
        if (!rawText || rawText.length < 50) {
          showStatus("error", "Could not extract text from PDF. It may be a scanned image. Try pasting text manually.");
          setLoading(false);
          uploadLabel.textContent = "Upload & Extract";
          return;
        }

        // Show the preview panel with extracted text
        showPDFPreview(rawText);
        setLoading(false);
        uploadLabel.textContent = "Upload & Extract";

      } catch (err) {
        setLoading(false);
        uploadLabel.textContent = "Upload & Extract";
        showStatus("error", "PDF extraction failed: " + err.message);
      }
    });

    // ================================================================
    // SIMPLE PDF TEXT EXTRACTION (Step 1)
    // ================================================================
    async function extractRawTextFromPDF(file) {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      let fullText = "";

      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const textContent = await page.getTextContent();
        // Simple: join all text items with space in the order they appear
        const pageText = textContent.items.map(item => item.str).join(" ");
        fullText += pageText + "\n\n";
      }

      return fullText.trim();
    }

    // ================================================================
    // PDF PREVIEW PANEL FUNCTIONS (Step 2)
    // ================================================================
    function showPDFPreview(text) {
      pdfPreviewText.value = text;
      pdfPreviewPanel.classList.remove("hidden");
      
      // Show AI option if API key is present
      const apiKey = apiKeyInput.value.trim();
      if (apiKey) {
        aiExtractOption.classList.remove("hidden");
      } else {
        aiExtractOption.classList.add("hidden");
      }
      
      pdfPreviewPanel.scrollIntoView({ behavior: "smooth" });
    }

    function hidePDFPreview() {
      pdfPreviewPanel.classList.add("hidden");
      pdfPreviewText.value = "";
    }

    // ================================================================
    // EXTRACT FROM PREVIEW BUTTON (Step 3)
    // ================================================================
    extractFromPreviewBtn.addEventListener("click", async () => {
      const resumeText = document.getElementById('pdfPreviewText').value.trim();
      if (!resumeText) {
        showStatus("error", "No text to extract");
        return;
      }

      // Copy text to the main textarea so existing handlers work
      resumeTextarea.value = resumeText;
      hidePDFPreview();
      hideStatus();
      setLoading(true);

      try {
        const apiKey = apiKeyInput.value.trim();
        let result;

        if (apiKey) {
          result = await extractWithLLM(resumeText, apiKey);
        } else {
          result = extractWithHeuristics(resumeText);
        }

        extractedJSON = result;
        renderDashboard(result);
        renderJSON(result);
        showDashboard();
        showStatus("success", apiKey
          ? "‚úì Extracted via OpenAI GPT-3.5-turbo"
          : "‚úì Extracted via regex/heuristic parsing (best-effort)");

      } catch (err) {
        showStatus("error", "Extraction failed: " + err.message);
      } finally {
        setLoading(false);
      }
    });

    // ================================================================
    // TEXT EXTRACT BUTTON
    // ================================================================
    extractBtn.addEventListener("click", async () => {
      const text = resumeTextarea.value.trim();
      if (!text) {
        showStatus("error", "Please paste your resume text first.");
        return;
      }

      hideStatus();
      setLoading(true);

      try {
        const apiKey = apiKeyInput.value.trim();
        let result;

        if (apiKey) {
          result = await extractWithLLM(text, apiKey);
        } else {
          result = extractWithHeuristics(text);
        }

        extractedJSON = result;
        renderDashboard(result);
        renderJSON(result);
        showDashboard();
        showStatus("success", apiKey
          ? "‚úì Extracted via OpenAI GPT-3.5-turbo"
          : "‚úì Extracted via regex/heuristic parsing (best-effort)");
      } catch (err) {
        showStatus("error", "Extraction failed: " + err.message);
      } finally {
        setLoading(false);
      }
    });

    function setLoading(on) {
      extractBtn.disabled = on;
      extractLabel.textContent = on ? "Extracting‚Ä¶" : "Extract JSON";
      extractSpinner.classList.toggle("hidden", !on);
    }

    // ================================================================
    // PROCESSING OVERLAY
    // ================================================================
    function showProcessing(title, subtitle) {
      processingTitle.textContent = title;
      processingSubtitle.textContent = subtitle;
      processingBar.style.width = "10%";
      processingOverlay.classList.remove("hidden");
    }

    function updateProcessingBar(pct) {
      processingBar.style.width = pct + "%";
    }

    function updateProcessingText(title, subtitle) {
      processingTitle.textContent = title;
      processingSubtitle.textContent = subtitle;
    }

    function hideProcessing() {
      processingOverlay.classList.add("hidden");
    }

    // ================================================================
    // DASHBOARD VIEW
    // ================================================================
    function showDashboard() {
      uploadSection.classList.add("hidden");
      dashboardSection.classList.remove("hidden");
      // Reset portfolio generator state
      generatorPanel.classList.add("hidden");
      previewPanel.classList.add("hidden");
      openGeneratorBtn.textContent = "Generate Portfolio";
      openGeneratorBtn.disabled = false;
      openGeneratorBtn.classList.remove("opacity-50", "cursor-not-allowed");
    }

    function showUpload() {
      dashboardSection.classList.add("hidden");
      uploadSection.classList.remove("hidden");
      clearFileSelection();
    }

    newUploadBtn.addEventListener("click", showUpload);

    // JSON toggle
    jsonToggle.addEventListener("click", () => {
      jsonPanel.classList.toggle("hidden");
      jsonChevron.classList.toggle("rotate-180");
    });

    // ================================================================
    // RENDER DASHBOARD
    // ================================================================
    function renderDashboard(data) {
      const p = data.personal || {};
      const exp = data.experience || [];
      const skills = data.skills || [];
      const edu = data.education || [];
      const projects = data.projects || [];

      // Stats
      statExperience.textContent = exp.length;
      statSkills.textContent = skills.length;
      statEducation.textContent = edu.length;
      statProjects.textContent = projects.length;

      // Personal card
      const name = p.name || "Unknown";
      const initials = name.split(" ").map(w => w[0]).join("").toUpperCase().slice(0, 2);
      personalInitials.textContent = initials;
      personalName.textContent = name;
      personalTitle.textContent = p.title || "Professional";

      // Personal details
      let detailsHTML = "";
      if (p.email) detailsHTML += `<span class="flex items-center gap-1">üìß ${escHTML(p.email)}</span>`;
      if (p.phone) detailsHTML += `<span class="flex items-center gap-1">üì± ${escHTML(p.phone)}</span>`;
      if (p.location) detailsHTML += `<span class="flex items-center gap-1">üìç ${escHTML(p.location)}</span>`;
      if (p.linkedin) detailsHTML += `<a href="${p.linkedin.startsWith('http') ? p.linkedin : 'https://' + p.linkedin}" target="_blank" class="text-indigo-400 hover:text-indigo-300 transition-colors">LinkedIn ‚Üó</a>`;
      if (p.github) detailsHTML += `<a href="${p.github.startsWith('http') ? p.github : 'https://' + p.github}" target="_blank" class="text-indigo-400 hover:text-indigo-300 transition-colors">GitHub ‚Üó</a>`;
      personalDetails.innerHTML = detailsHTML;

      // Summary
      if (data.summary) {
        summaryBlock.classList.remove("hidden");
        summaryText.textContent = data.summary;
      } else {
        summaryBlock.classList.add("hidden");
      }

      // Experience
      if (exp.length) {
        experienceList.innerHTML = exp.map(e => `
          <div class="bg-gray-900/30 border border-gray-800/50 rounded-xl p-4 card-hover">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
              <h4 class="font-semibold text-white">${escHTML(e.role || e.company || "")}</h4>
              <span class="text-xs text-gray-500 mt-1 sm:mt-0">${escHTML(e.duration || "")}</span>
            </div>
            <p class="text-sm text-indigo-400 mb-2">${escHTML(e.company || "")}</p>
            ${(e.achievements || []).length ? `
              <ul class="space-y-1">
                ${e.achievements.map(a => `<li class="text-sm text-gray-400 flex gap-2"><span class="text-gray-600 flex-shrink-0">‚Ä¢</span><span>${escHTML(a)}</span></li>`).join("")}
              </ul>
            ` : ""}
          </div>
        `).join("");
      } else {
        experienceList.innerHTML = '<p class="text-sm text-gray-600">No experience data found.</p>';
      }

      // Skills
      if (skills.length) {
        skillsList.innerHTML = skills.map(s =>
          `<span class="px-3 py-1.5 bg-gray-800/50 border border-gray-700/50 text-gray-300 text-xs rounded-full hover:border-indigo-500/50 transition-colors">${escHTML(s)}</span>`
        ).join("");
      } else {
        skillsList.innerHTML = '<p class="text-sm text-gray-600">No skills found.</p>';
      }

      // Education
      if (edu.length) {
        educationList.innerHTML = edu.map(e => `
          <div class="bg-gray-900/30 border border-gray-800/50 rounded-lg p-3">
            <p class="text-sm font-medium text-white">${escHTML(e.degree || "")}</p>
            <p class="text-xs text-gray-500">${escHTML(e.institution || "")}</p>
            ${e.year ? `<p class="text-xs text-gray-600 mt-1">${escHTML(e.year)}</p>` : ""}
          </div>
        `).join("");
      } else {
        educationList.innerHTML = '<p class="text-sm text-gray-600">No education data found.</p>';
      }

      // Projects
      if (projects.length) {
        projectsBlock.classList.remove("hidden");
        projectsList.innerHTML = projects.map(proj => `
          <div class="bg-gray-900/30 border border-gray-800/50 rounded-xl p-4 card-hover">
            <h4 class="font-semibold text-white mb-1">${escHTML(proj.name || "")}</h4>
            <p class="text-sm text-gray-400 mb-3">${escHTML(proj.description || "")}</p>
            ${(proj.technologies || []).length ? `
              <div class="flex flex-wrap gap-1.5 mb-2">
                ${proj.technologies.map(t => `<span class="px-2 py-0.5 bg-indigo-600/10 text-indigo-400 text-xs rounded-full">${escHTML(t)}</span>`).join("")}
              </div>
            ` : ""}
            ${proj.link ? `<a href="${proj.link.startsWith('http') ? proj.link : 'https://' + proj.link}" target="_blank" class="text-xs text-indigo-400 hover:text-indigo-300 transition-colors">View Project ‚Üó</a>` : ""}
          </div>
        `).join("");
      } else {
        projectsBlock.classList.add("hidden");
      }
    }

    function escHTML(str) {
      return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
    }

    // ----- Status helpers -----
    function showStatus(type, message) {
      statusMsg.className = "text-sm rounded-xl px-4 py-3 max-w-2xl mx-auto mt-4 " + ({
        success: "bg-green-900/30 border border-green-700/50 text-green-300",
        error:   "bg-red-900/30 border border-red-700/50 text-red-300",
        info:    "bg-blue-900/30 border border-blue-700/50 text-blue-300",
      }[type] || "");
      statusMsg.textContent = message;
      statusMsg.classList.remove("hidden");
    }

    function hideStatus() {
      statusMsg.classList.add("hidden");
    }

    // ================================================================
    // LLM EXTRACTION (OpenAI API)
    // ================================================================
    async function extractWithLLM(resumeText, apiKey) {
      const systemPrompt = `You are a resume parser. Extract structured data from the provided resume text and return ONLY valid JSON matching this exact schema (no markdown, no explanation):

{
  "personal": {
    "name": "",
    "title": "",
    "email": "",
    "phone": "",
    "linkedin": "",
    "github": "",
    "location": ""
  },
  "summary": "",
  "experience": [
    {
      "company": "",
      "role": "",
      "duration": "",
      "achievements": []
    }
  ],
  "education": [
    {
      "institution": "",
      "degree": "",
      "year": ""
    }
  ],
  "skills": [],
  "projects": [
    {
      "name": "",
      "description": "",
      "technologies": [],
      "link": ""
    }
  ]
}

Rules:
- Fill in every field you can find. Use empty string "" for missing text fields, empty array [] for missing arrays.
- "achievements" should be an array of strings (bullet points).
- "skills" should be a flat array of skill strings.
- "duration" should be the date range as written (e.g. "Jan 2021 ‚Äì Present").
- Return ONLY the JSON object, nothing else.`;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${apiKey}`,
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [
            { role: "system", content: systemPrompt },
            { role: "user", content: resumeText },
          ],
          temperature: 0.1,
          max_tokens: 2000,
        }),
      });

      if (!response.ok) {
        const err = await response.json().catch(() => ({}));
        throw new Error(err.error?.message || `API returned ${response.status}`);
      }

      const data = await response.json();
      const content = data.choices?.[0]?.message?.content?.trim();

      if (!content) throw new Error("Empty response from API");

      const cleaned = content.replace(/^```(?:json)?\s*/i, "").replace(/\s*```$/i, "");

      try {
        return JSON.parse(cleaned);
      } catch {
        throw new Error("API returned invalid JSON. Raw response: " + content.slice(0, 200));
      }
    }

    // ================================================================
    // HEURISTIC / REGEX EXTRACTION (fallback) - REVAMPED
    // ================================================================
    function extractWithHeuristics(text) {
      const lines = text.split(/\n/);
      const trimmedLines = lines.map(l => l.trim()).filter(Boolean);

      // Helper: Find first match
      const findFirst = (regex) => {
        for (const line of trimmedLines) {
          const m = line.match(regex);
          if (m) return m;
        }
        return null;
      };

      // ENHANCED SECTION HEADERS - More comprehensive
      const sectionHeaders = /^(summary|objective|profile|about|professional summary|experience|work experience|employment|career|education|academic|qualifications|skills|technical skills|core competencies|expertise|technologies|projects|personal projects|key projects|certifications|awards|honors|publications|languages|interests|references)/i;

      function getSectionContent(sectionRegex) {
        const content = [];
        let capturing = false;
        for (const line of lines) {
          const trimmed = line.trim();
          if (!trimmed) {
            if (capturing) content.push("");
            continue;
          }
          if (sectionRegex.test(trimmed)) {
            capturing = true;
            continue;
          }
          if (capturing && sectionHeaders.test(trimmed)) {
            break;
          }
          if (capturing) content.push(trimmed);
        }
        return content;
      }

      // ---- ENHANCED PERSONAL INFO ----
      const emailMatch = findFirst(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/);
      const phoneMatch = findFirst(/(?:\+?1[-.\s]?)?\(?([0-9]{3})\)?[-.\s]?([0-9]{3})[-.\s]?([0-9]{4})/);
      const linkedinMatch = findFirst(/(?:https?:\/\/)?(?:www\.)?linkedin\.com\/(?:in|profile)\/[a-zA-Z0-9_-]+\/?/i);
      const githubMatch = findFirst(/(?:https?:\/\/)?(?:www\.)?github\.com\/[a-zA-Z0-9_-]+\/?/i);

      // SIMPLIFIED name detection - more lenient patterns
      let name = "";
      let title = "";
      
      for (let i = 0; i < Math.min(15, trimmedLines.length); i++) {
        const line = trimmedLines[i];
        
        // Skip obvious non-name lines
        if (line.includes('@')) continue; // Email
        if (line.includes('http')) continue; // URLs
        if (line.includes('linkedin.com') || line.includes('github.com')) continue;
        if (/^\d{3}-\d{3}-\d{4}$/.test(line)) continue; // Phone
        if (sectionHeaders.test(line)) break;
        
        // Check if line looks like a name (2-4 words, each capitalized)
        const words = line.split(/\s+/).filter(w => w.length > 0);
        const allWordsCapitalized = words.every(w => /^[A-Z][a-zA-Z]*$/.test(w));
        
        // Name pattern: 2-4 capitalized words, 5-40 chars total
        if (words.length >= 2 && words.length <= 4 && allWordsCapitalized && line.length >= 5 && line.length <= 40) {
          // Additional check: not all caps (like a header)
          if (!/^[A-Z\s]+$/.test(line)) {
            name = line;
            break; // Stop after finding first potential name
          }
        }
      }

      // If still no name, try first non-contact line
      if (!name) {
        for (const line of trimmedLines) {
          if (line.includes('@') || line.includes('http') || /^\d/.test(line)) continue;
          if (sectionHeaders.test(line)) break;
          if (line.length > 3 && line.length < 40 && !/^\s*[-‚Ä¢]/.test(line)) {
            name = line;
            break;
          }
        }
      }

      // Look for title after name (next 3 lines)
      if (name) {
        const nameIdx = trimmedLines.indexOf(name);
        for (let i = nameIdx + 1; i < Math.min(nameIdx + 4, trimmedLines.length); i++) {
          const line = trimmedLines[i];
          // Skip contact info
          if (line.includes('@') || line.includes('http') || /^\d/.test(line)) continue;
          // Title should be a reasonable phrase
          if (line.length > 3 && line.length < 60 && !sectionHeaders.test(line)) {
            title = line;
            break;
          }
        }
      }

      const locationMatch = findFirst(/([A-Z][a-zA-Z\s]+,\s*[A-Z]{2})/);
      const location = locationMatch ? locationMatch[1] : "";

      const personal = {
        name: name,
        title: title,
        email: emailMatch ? emailMatch[0] : "",
        phone: phoneMatch ? phoneMatch[0] : "",
        linkedin: linkedinMatch ? linkedinMatch[0] : "",
        github: githubMatch ? githubMatch[0] : "",
        location: location,
      };

      // ---- SUMMARY ----
      const summaryLines = getSectionContent(/^(summary|objective|profile|about)\s*:?\s*$/i);
      const summary = summaryLines.filter(Boolean).join(" ").trim();

      // ---- EXPERIENCE ----
      const expLines = getSectionContent(/^(experience|work experience|employment)\s*:?\s*$/i);
      const experience = parseExperience(expLines);

      // ---- EDUCATION ----
      const eduLines = getSectionContent(/^(education|academic)\s*:?\s*$/i);
      const education = parseEducation(eduLines);

      // ---- SKILLS ----
      const skillLines = getSectionContent(/^(skills|technical skills|core competencies)\s*:?\s*$/i);
      const skills = parseSkills(skillLines);

      // ---- PROJECTS ----
      const projLines = getSectionContent(/^(projects|personal projects)\s*:?\s*$/i);
      const projects = parseProjects(projLines);

      return { personal, summary, experience, education, skills, projects };
    }

    // SIMPLIFIED Experience Parser
    function parseExperience(lines) {
      if (!lines.length) return [];

      const dateRangeRe = /\b((?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\.?\s+\d{4}|\d{1,2}\/\d{4}|\d{4})\s*[-‚Äì‚Äî]\s*((?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\.?\s+\d{4}|\d{1,2}\/\d{4}|\d{4}|present|current|now)\b/i;
      const bulletRe = /^[‚Ä¢\-‚Äì‚Äî*‚ñ™‚ñ∏‚ñ∫‚Ä£‚ó¶‚àô¬∑]\s*/;
      const entries = [];
      let current = null;
      let achievements = [];

      for (const line of lines) {
        if (!line || !line.trim()) continue;

        const trimmed = line.trim();
        const isBullet = bulletRe.test(trimmed);
        const dateMatch = trimmed.match(dateRangeRe);

        // New entry: has date and not a bullet
        if (dateMatch && !isBullet) {
          // Save previous entry
          if (current) {
            current.achievements = achievements;
            entries.push(current);
            achievements = [];
          }

          current = { company: "", role: "", duration: "", achievements: [] };
          current.duration = dateMatch[0];

          // Parse role and company from remaining text
          let remaining = trimmed.replace(dateRangeRe, "").trim();
          remaining = remaining.replace(/^[|-‚Äì‚Äî@\s]+/, "").trim();
          
          // Common patterns: "Role at Company" or "Role | Company" or "Role - Company"
          const separators = /\s*(?:at|\||@|[-‚Äì‚Äî])\s*/i;
          const parts = remaining.split(separators).filter(s => s.trim());
          
          if (parts.length >= 2) {
            current.role = parts[0].trim();
            current.company = parts[1].trim();
          } else {
            current.role = remaining;
          }
        }
        // Bullet point = achievement
        else if (current && isBullet) {
          achievements.push(trimmed.replace(bulletRe, "").trim());
        }
        // Non-bullet text after entry started = might be additional info or achievement
        else if (current && trimmed.length > 10) {
          achievements.push(trimmed);
        }
      }

      // Don't forget last entry
      if (current) {
        current.achievements = achievements;
        entries.push(current);
      }

      return entries;
    }

    // SIMPLIFIED Education Parser
    function parseEducation(lines) {
      if (!lines.length) return [];

      const entries = [];
      let current = null;
      const degreeKeywords = /\b(B\.?S\.?|B\.?A\.?|M\.?S\.?|M\.?A\.?|MBA|Ph\.?D|Bachelor|Master|Doctorate|Associate|Diploma|Certificate)\b/i;
      const yearRe = /\b(19|20)\d{2}\b/g;

      for (const line of lines) {
        if (!line || !line.trim()) continue;

        const trimmed = line.trim();
        const hasDegree = degreeKeywords.test(trimmed);
        const years = trimmed.match(yearRe);

        // New entry if has degree or year
        if (hasDegree || years || (/^[A-Z]/.test(trimmed) && trimmed.length > 5)) {
          if (current) entries.push(current);
          current = { institution: "", degree: "", year: "" };

          // Extract year(s)
          if (years) {
            current.year = years[years.length - 1]; // Use last year (graduation)
          }

          // Simple split: degree often comes first
          if (hasDegree) {
            const degreeMatch = trimmed.match(degreeKeywords);
            if (degreeMatch) {
              current.degree = degreeMatch[0];
              // Institution is usually after degree
              const parts = trimmed.split(/[,|-]/).map(s => s.trim());
              if (parts.length > 1) {
                current.institution = parts[parts.length - 1].replace(/\d{4}/g, "").trim();
              }
            }
          } else {
            // No degree found - assume it's the institution
            current.institution = trimmed.replace(/\d{4}/g, "").trim();
          }
        }
      }

      if (current) entries.push(current);
      return entries;
    }

    // SIMPLIFIED Skills Parser
    function parseSkills(lines) {
      if (!lines.length) return [];
      
      const allText = lines.join(" ");
      const skills = [];
      
      // Split by common delimiters
      const parts = allText.split(/[,;|]/);
      
      for (const part of parts) {
        const skill = part.trim();
        // Keep skills that are reasonable length and not headers
        if (skill && skill.length > 1 && skill.length < 25 &&
            !/^(skills|technologies|expertise|proficient)$/i.test(skill)) {
          skills.push(skill);
        }
      }

      return skills;
    }

    // SIMPLIFIED Projects Parser
    function parseProjects(lines) {
      if (!lines.length) return [];

      const bulletRe = /^[‚Ä¢\-‚Äì‚Äî*]\s*/;
      const urlRe = /github\.com\/[^\s]+/i;
      const entries = [];
      let current = null;
      let description = [];

      for (const line of lines) {
        if (!line || !line.trim()) continue;

        const trimmed = line.trim();
        const isBullet = bulletRe.test(trimmed);
        const urlMatch = trimmed.match(urlRe);

        // New project: starts with capital letter, not a bullet, reasonable length
        if (!isBullet && /^[A-Z]/.test(trimmed) && trimmed.length < 60 && !urlMatch) {
          // Save previous
          if (current) {
            current.description = description.join(" ");
            entries.push(current);
            description = [];
          }

          current = { name: trimmed, description: "", technologies: [], link: "" };
        }
        // Line with URL
        else if (urlMatch && current) {
          current.link = "https://" + urlMatch[0];
          // If there's text before URL, it's part of description
          const textBefore = trimmed.substring(0, trimmed.indexOf(urlMatch[0])).trim();
          if (textBefore && textBefore.length > 3) {
            description.push(textBefore);
          }
        }
        // Bullet point or description
        else if (current) {
          const cleaned = trimmed.replace(bulletRe, "").trim();
          if (cleaned) description.push(cleaned);
        }
      }

      if (current) {
        current.description = description.join(" ");
        entries.push(current);
      }

      return entries;
    }

    // ================================================================
    // JSON RENDERING with syntax highlighting
    // ================================================================
    function renderJSON(obj) {
      const raw = JSON.stringify(obj, null, 2);
      const highlighted = raw
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"([^"]+)"(?=\s*:)/g, '<span class="json-key">"$1"</span>')
        .replace(/:\s*"([^"]*)"/g, ': <span class="json-string">"$1"</span>')
        .replace(/:\s*(\d+)/g, ': <span class="json-number">$1</span>')
        .replace(/:\s*(true|false)/g, ': <span class="json-boolean">$1</span>')
        .replace(/:\s*(null)/g, ': <span class="json-null">$1</span>')
        .replace(/([[\]{}])/g, '<span class="json-bracket">$1</span>');

      jsonOutput.innerHTML = highlighted;
    }

    // ================================================================
    // COPY & DOWNLOAD
    // ================================================================
    copyBtn.addEventListener("click", () => {
      if (!extractedJSON) return;
      const text = JSON.stringify(extractedJSON, null, 2);
      navigator.clipboard.writeText(text).then(() => {
        const orig = copyBtn.textContent;
        copyBtn.textContent = "‚úì Copied!";
        setTimeout(() => { copyBtn.textContent = orig; }, 1500);
      });
    });

    downloadBtn.addEventListener("click", () => {
      if (!extractedJSON) return;
      const text = JSON.stringify(extractedJSON, null, 2);
      const blob = new Blob([text], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "resume.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // ================================================================
    // PHASE 2: PORTFOLIO GENERATION
    // ================================================================
    openGeneratorBtn.addEventListener("click", () => {
      generatorPanel.classList.remove("hidden");
      openGeneratorBtn.textContent = "‚Üì Choose a template below";
      openGeneratorBtn.disabled = true;
      openGeneratorBtn.classList.add("opacity-50", "cursor-not-allowed");
    });

    generateWebsiteBtn.addEventListener("click", () => {
      if (!extractedJSON) return;
      genLabel.textContent = "Generating‚Ä¶";
      genSpinner.classList.remove("hidden");
      generateWebsiteBtn.disabled = true;

      setTimeout(() => {
        try {
          generatedHTML = generateMinimalistPortfolio(extractedJSON);
          portfolioPreview.srcdoc = generatedHTML;
          previewPanel.classList.remove("hidden");
          genLabel.textContent = "‚úì Generated!";
          genSpinner.classList.add("hidden");
          previewPanel.scrollIntoView({ behavior: "smooth", block: "start" });
        } catch (err) {
          showStatus("error", "Portfolio generation failed: " + err.message);
          genLabel.textContent = "Generate Website";
          genSpinner.classList.add("hidden");
          generateWebsiteBtn.disabled = false;
        }
      }, 100);
    });

    downloadPortfolioBtn.addEventListener("click", () => {
      if (!generatedHTML) return;
      const blob = new Blob([generatedHTML], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "portfolio.html";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // ================================================================
    // MINIMALIST PORTFOLIO TEMPLATE
    // ================================================================
    function generateMinimalistPortfolio(data) {
      const p = data.personal || {};
      const name = escHTML(p.name || "Your Name");
      const title = escHTML(p.title || "Professional");
      const email = p.email || "";
      const linkedin = p.linkedin || "";
      const github = p.github || "";
      const location = escHTML(p.location || "");
      const summary = escHTML(data.summary || "");
      const experience = data.experience || [];
      const education = data.education || [];
      const skills = data.skills || [];
      const projects = data.projects || [];

      function makeLink(url) {
        if (!url) return "";
        const href = url.startsWith("http") ? url : "https://" + url;
        return href;
      }

      let socialHTML = "";
      if (email) socialHTML += `<a href="mailto:${escHTML(email)}" class="text-gray-400 hover:text-blue-400 transition-colors"><svg class="w-5 h-5 inline" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg> <span class="ml-1">${escHTML(email)}</span></a>`;
      if (linkedin) socialHTML += `<a href="${makeLink(linkedin)}" target="_blank" class="text-gray-400 hover:text-blue-400 transition-colors"><svg class="w-5 h-5 inline" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg> <span class="ml-1">LinkedIn</span></a>`;
      if (github) socialHTML += `<a href="${makeLink(github)}" target="_blank" class="text-gray-400 hover:text-blue-400 transition-colors"><svg class="w-5 h-5 inline" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg> <span class="ml-1">GitHub</span></a>`;

      let expHTML = "";
      experience.forEach(exp => {
        const achievements = (exp.achievements || []).map(a => `<li class="text-gray-400 text-sm leading-relaxed">${escHTML(a)}</li>`).join("");
        expHTML += `
          <div class="fade-in relative pl-8 pb-10 border-l-2 border-gray-800 last:pb-0">
            <div class="absolute left-[-9px] top-0 w-4 h-4 rounded-full bg-blue-500 border-4 border-gray-950"></div>
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-1">
              <h3 class="text-lg font-semibold text-white">${escHTML(exp.role || "")}</h3>
              <span class="text-sm text-gray-500">${escHTML(exp.duration || "")}</span>
            </div>
            <p class="text-blue-400 text-sm mb-3">${escHTML(exp.company || "")}</p>
            ${achievements ? `<ul class="space-y-1.5 list-disc list-inside">${achievements}</ul>` : ""}
          </div>`;
      });

      let projHTML = "";
      projects.forEach(proj => {
        const techs = (proj.technologies || []).map(t => `<span class="px-2 py-1 bg-gray-800 text-blue-400 text-xs rounded-full">${escHTML(t)}</span>`).join("");
        const linkBtn = proj.link ? `<a href="${makeLink(proj.link)}" target="_blank" class="inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors mt-3">View Project <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg></a>` : "";
        projHTML += `
          <div class="fade-in bg-gray-900/50 border border-gray-800 rounded-xl p-6 hover:border-gray-700 transition-colors">
            <h3 class="text-lg font-semibold text-white mb-2">${escHTML(proj.name || "")}</h3>
            <p class="text-gray-400 text-sm mb-4">${escHTML(proj.description || "")}</p>
            <div class="flex flex-wrap gap-2">${techs}</div>
            ${linkBtn}
          </div>`;
      });

      const skillsHTML = skills.map(s => `<span class="fade-in px-4 py-2 bg-gray-900/50 border border-gray-800 text-gray-300 text-sm rounded-full hover:border-blue-500/50 transition-colors">${escHTML(s)}</span>`).join("");

      let eduHTML = "";
      education.forEach(edu => {
        eduHTML += `
          <div class="fade-in flex flex-col sm:flex-row sm:items-center sm:justify-between py-4 border-b border-gray-800 last:border-0">
            <div>
              <h3 class="text-white font-medium">${escHTML(edu.degree || "")}</h3>
              <p class="text-gray-400 text-sm">${escHTML(edu.institution || "")}</p>
            </div>
            <span class="text-gray-500 text-sm mt-1 sm:mt-0">${escHTML(edu.year || "")}</span>
          </div>`;
      });

      return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${name} ‚Äî Portfolio</title>
  <script src="https://cdn.tailwindcss.com"><\/script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    html { scroll-behavior: smooth; }
    body { background: #0a0a0a; color: #fff; }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    .fade-in.visible {
      opacity: 1;
      transform: translateY(0);
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
  </style>
</head>
<body class="antialiased">

  <!-- Navigation -->
  <nav class="fixed top-0 w-full bg-[#0a0a0a]/80 backdrop-blur-lg border-b border-gray-800/50 z-50">
    <div class="max-w-5xl mx-auto px-6 py-4 flex items-center justify-between">
      <a href="#hero" class="text-lg font-bold text-white">${name.split(" ")[0]}<span class="text-blue-500">.</span></a>
      <div class="hidden sm:flex items-center gap-8">
        ${experience.length ? '<a href="#experience" class="text-sm text-gray-400 hover:text-white transition-colors">Experience</a>' : ""}
        ${projects.length ? '<a href="#projects" class="text-sm text-gray-400 hover:text-white transition-colors">Projects</a>' : ""}
        ${skills.length ? '<a href="#skills" class="text-sm text-gray-400 hover:text-white transition-colors">Skills</a>' : ""}
        ${education.length ? '<a href="#education" class="text-sm text-gray-400 hover:text-white transition-colors">Education</a>' : ""}
      </div>
    </div>
  </nav>

  <main class="max-w-5xl mx-auto px-6">

    <!-- Hero -->
    <section id="hero" class="min-h-screen flex flex-col justify-center py-20 pt-32">
      <div class="fade-in">
        <p class="text-blue-500 text-sm font-medium tracking-wider uppercase mb-4">Hello, I'm</p>
        <h1 class="text-5xl sm:text-7xl font-extrabold text-white leading-tight mb-4">${name}</h1>
        <h2 class="text-2xl sm:text-3xl font-light text-gray-400 mb-6">${title}</h2>
        ${summary ? `<p class="text-gray-500 text-lg max-w-2xl leading-relaxed mb-8">${escHTML(summary)}</p>` : ""}
        ${location ? `<p class="text-gray-600 text-sm mb-6">üìç ${location}</p>` : ""}
        <div class="flex flex-wrap items-center gap-6">
          ${socialHTML}
        </div>
      </div>
    </section>

    ${experience.length ? `
    <!-- Experience -->
    <section id="experience" class="py-20">
      <h2 class="fade-in text-3xl font-bold text-white mb-12">Experience</h2>
      <div class="space-y-0">
        ${expHTML}
      </div>
    </section>` : ""}

    ${projects.length ? `
    <!-- Projects -->
    <section id="projects" class="py-20">
      <h2 class="fade-in text-3xl font-bold text-white mb-12">Projects</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        ${projHTML}
      </div>
    </section>` : ""}

    ${skills.length ? `
    <!-- Skills -->
    <section id="skills" class="py-20">
      <h2 class="fade-in text-3xl font-bold text-white mb-12">Skills</h2>
      <div class="flex flex-wrap gap-3">
        ${skillsHTML}
      </div>
    </section>` : ""}

    ${education.length ? `
    <!-- Education -->
    <section id="education" class="py-20">
      <h2 class="fade-in text-3xl font-bold text-white mb-12">Education</h2>
      <div class="bg-gray-900/30 border border-gray-800 rounded-xl p-6">
        ${eduHTML}
      </div>
    </section>` : ""}

  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-800/50 py-8 text-center">
    <p class="text-gray-600 text-sm">&copy; ${new Date().getFullYear()} ${name}. Built with R2P.</p>
  </footer>

  <script>
    // Intersection Observer for fade-in animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
  <\/script>
</body>
</html>`;
    }

  })();
  </script>
</body>
</html>
