<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>R2P â€” Resume to Portfolio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }

    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #1e293b; border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }

    /* Spinner animation */
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner {
      width: 20px; height: 20px;
      border: 3px solid rgba(255,255,255,0.2);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      display: inline-block;
    }
    .spinner-lg {
      width: 40px; height: 40px;
      border: 4px solid rgba(99,102,241,0.2);
      border-top-color: #6366f1;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    /* JSON syntax highlighting */
    .json-key { color: #93c5fd; }
    .json-string { color: #86efac; }
    .json-number { color: #fde68a; }
    .json-boolean { color: #f9a8d4; }
    .json-null { color: #a5b4fc; }
    .json-bracket { color: #cbd5e1; }

    /* Drag and drop zone */
    .drop-zone {
      border: 2px dashed #4b5563;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .drop-zone::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(99,102,241,0.05) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .drop-zone:hover::before,
    .drop-zone.drag-over::before {
      opacity: 1;
    }
    .drop-zone:hover, .drop-zone.drag-over {
      border-color: #6366f1;
      background: rgba(99,102,241,0.05);
    }
    .drop-zone.drag-over {
      transform: scale(1.01);
      box-shadow: 0 0 30px rgba(99,102,241,0.15);
    }

    /* Step indicator */
    .step-item {
      position: relative;
      transition: all 0.3s ease;
    }
    .step-item .step-number {
      width: 32px; height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }
    .step-item.active .step-number {
      background: #6366f1;
      color: white;
      box-shadow: 0 0 20px rgba(99,102,241,0.4);
    }
    .step-item.completed .step-number {
      background: #22c55e;
      color: white;
    }
    .step-item.pending .step-number {
      background: #1e293b;
      color: #64748b;
      border: 2px solid #334155;
    }
    .step-connector {
      width: 40px;
      height: 2px;
      background: #334155;
      transition: background 0.3s ease;
    }
    .step-connector.completed {
      background: #22c55e;
    }

    /* Card animations */
    .card-animate {
      opacity: 0;
      transform: translateY(20px);
      animation: cardIn 0.5s ease forwards;
    }
    @keyframes cardIn {
      to { opacity: 1; transform: translateY(0); }
    }

    /* Collapsible sections */
    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.3s ease;
    }
    .collapsible-content.open {
      max-height: 2000px;
    }

    /* Pulse animation for upload icon */
    @keyframes pulse-soft {
      0%, 100% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.05); opacity: 1; }
    }
    .pulse-soft {
      animation: pulse-soft 2s ease-in-out infinite;
    }

    /* Gradient text */
    .gradient-text {
      background: linear-gradient(135deg, #6366f1, #8b5cf6, #a78bfa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Glass card */
    .glass-card {
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(51, 65, 85, 0.5);
    }

    /* Editable field */
    .editable-field {
      transition: all 0.2s ease;
      border: 1px solid transparent;
      border-radius: 6px;
      padding: 2px 6px;
      margin: -2px -6px;
    }
    .editable-field:hover {
      border-color: #334155;
      background: rgba(30, 41, 59, 0.5);
    }
    .editable-field:focus {
      border-color: #6366f1;
      background: rgba(30, 41, 59, 0.8);
      outline: none;
      box-shadow: 0 0 0 3px rgba(99,102,241,0.2);
    }

    /* Smooth transitions for sections */
    .section-fade {
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .section-fade.hidden-section {
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
      position: absolute;
      visibility: hidden;
    }

    /* File info card */
    .file-info-card {
      background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(139,92,246,0.1));
      border: 1px solid rgba(99,102,241,0.3);
    }

    /* Mobile responsive sidebar */
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .main-content { margin-left: 0 !important; }
    }
  </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen">

  <!-- ===== HEADER ===== -->
  <header class="border-b border-gray-800/50 bg-gray-900/80 backdrop-blur-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm shadow-lg shadow-indigo-500/20">
          R2P
        </div>
        <div>
          <h1 class="text-lg font-bold tracking-tight text-white">Resume to Portfolio</h1>
          <p class="text-xs text-gray-500 hidden sm:block">Transform your resume into a stunning portfolio</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <span class="text-xs text-gray-500 hidden sm:inline">Phase 3A</span>
        <button id="settingsBtn" class="p-2 rounded-lg hover:bg-gray-800 transition-colors text-gray-400 hover:text-gray-200" title="Settings">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        </button>
      </div>
    </div>
  </header>

  <!-- ===== SETTINGS PANEL (hidden by default) ===== -->
  <div id="settingsPanel" class="hidden fixed inset-0 z-50 flex items-start justify-center pt-20">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" id="settingsOverlay"></div>
    <div class="relative bg-gray-900 rounded-2xl border border-gray-700 p-6 w-full max-w-md mx-4 shadow-2xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white">Settings</h3>
        <button id="closeSettings" class="p-1 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-white transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="space-y-4">
        <div>
          <label for="apiKey" class="block text-sm font-medium text-gray-300 mb-1">
            OpenAI API Key <span class="text-gray-500">(optional)</span>
          </label>
          <div class="flex gap-2">
            <input
              id="apiKey"
              type="password"
              placeholder="sk-..."
              class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
            />
            <button id="toggleKey" class="text-xs text-gray-400 hover:text-gray-200 px-3 py-2 rounded-lg bg-gray-800 hover:bg-gray-700 transition-colors">Show</button>
          </div>
          <p id="modeIndicator" class="mt-2 text-xs text-gray-500">
            Mode: <span class="text-amber-400 font-medium">Regex/Heuristic fallback</span>
          </p>
          <p class="mt-1 text-xs text-gray-600">Paste an API key to use GPT extraction for higher accuracy.</p>
        </div>
      </div>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-6">

    <!-- ===== PROGRESS STEPS ===== -->
    <div class="flex items-center justify-center mb-8">
      <div class="flex items-center gap-0">
        <div class="step-item active" id="step1">
          <div class="flex items-center gap-2">
            <div class="step-number">1</div>
            <span class="text-sm font-medium text-white hidden sm:inline">Upload</span>
          </div>
        </div>
        <div class="step-connector mx-3" id="connector1"></div>
        <div class="step-item pending" id="step2">
          <div class="flex items-center gap-2">
            <div class="step-number">2</div>
            <span class="text-sm font-medium text-gray-500 hidden sm:inline">Extract</span>
          </div>
        </div>
        <div class="step-connector mx-3" id="connector2"></div>
        <div class="step-item pending" id="step3">
          <div class="flex items-center gap-2">
            <div class="step-number">3</div>
            <span class="text-sm font-medium text-gray-500 hidden sm:inline">Portfolio</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== STATUS MESSAGE ===== -->
    <div id="statusMsg" class="hidden text-sm rounded-xl px-4 py-3 mb-6"></div>

    <!-- ================================================================== -->
    <!-- STEP 1: UPLOAD SECTION -->
    <!-- ================================================================== -->
    <section id="uploadSection" class="section-fade">
      <div class="text-center mb-8">
        <h2 class="text-2xl sm:text-3xl font-bold text-white mb-2">Upload Your Resume</h2>
        <p class="text-gray-400 text-sm sm:text-base">Drop a PDF or paste your resume text to get started</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- PDF Upload Card -->
        <div class="glass-card rounded-2xl p-6">
          <div class="flex items-center gap-2 mb-4">
            <div class="w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center">
              <svg class="w-4 h-4 text-indigo-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
            </div>
            <h3 class="text-base font-semibold text-white">Upload PDF</h3>
            <span class="text-xs bg-indigo-500/20 text-indigo-300 px-2 py-0.5 rounded-full">Recommended</span>
          </div>

          <!-- Drop Zone -->
          <div id="dropZone" class="drop-zone rounded-xl p-8 text-center cursor-pointer min-h-[200px] flex flex-col items-center justify-center">
            <div id="dropZoneContent">
              <div class="pulse-soft mb-4">
                <svg class="w-12 h-12 text-gray-500 mx-auto" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
                </svg>
              </div>
              <p class="text-gray-300 font-medium mb-1">Drag & drop your PDF here</p>
              <p class="text-gray-500 text-sm mb-3">or click to browse files</p>
              <span class="text-xs text-gray-600">Supports .pdf files up to 10MB</span>
            </div>
            <!-- File selected state -->
            <div id="fileInfo" class="hidden w-full">
              <div class="file-info-card rounded-xl p-4 flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center flex-shrink-0">
                  <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg>
                </div>
                <div class="flex-1 min-w-0 text-left">
                  <p id="fileName" class="text-white font-medium text-sm truncate"></p>
                  <p id="fileSize" class="text-gray-400 text-xs"></p>
                </div>
                <button id="removeFile" class="p-2 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-red-400 transition-colors flex-shrink-0">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
              </div>
            </div>
            <!-- Loading state -->
            <div id="pdfLoading" class="hidden flex flex-col items-center gap-3">
              <div class="spinner-lg"></div>
              <p class="text-gray-300 text-sm">Extracting text from PDF...</p>
            </div>
          </div>
          <input type="file" id="fileInput" accept=".pdf" class="hidden" />
        </div>

        <!-- Text Paste Card -->
        <div class="glass-card rounded-2xl p-6">
          <div class="flex items-center gap-2 mb-4">
            <div class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center">
              <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            </div>
            <h3 class="text-base font-semibold text-white">Paste Text</h3>
          </div>
          <textarea
            id="resumeText"
            rows="9"
            placeholder="Paste your resume text here...&#10;&#10;John Doe&#10;Software Engineer&#10;john@example.com&#10;&#10;EXPERIENCE&#10;Senior Developer â€” Acme Corp&#10;â€¢ Led migration of monolith to microservices..."
            class="w-full bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-3 text-sm text-gray-200 placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-y min-h-[200px]"
          ></textarea>
        </div>
      </div>

      <!-- Extract Button -->
      <div class="flex justify-center mt-6">
        <button
          id="extractBtn"
          class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 active:from-indigo-700 active:to-purple-700 text-white font-semibold px-8 py-3 rounded-xl text-sm transition-all shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
          <span id="extractLabel">Extract Resume Data</span>
          <div id="extractSpinner" class="spinner hidden"></div>
        </button>
      </div>
    </section>

    <!-- ================================================================== -->
    <!-- STEP 2: EXTRACTED DATA SECTION -->
    <!-- ================================================================== -->
    <section id="resultsSection" class="section-fade hidden-section">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-2xl font-bold text-white">Extracted Data</h2>
          <p class="text-gray-400 text-sm mt-1">Review and edit your resume information</p>
        </div>
        <div class="flex gap-2">
          <button id="backToUpload" class="text-sm text-gray-400 hover:text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors flex items-center gap-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
            Back
          </button>
          <button id="copyBtn" class="text-sm bg-gray-800 hover:bg-gray-700 text-gray-300 px-4 py-2 rounded-lg transition-colors flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
            Copy JSON
          </button>
          <button id="downloadBtn" class="text-sm bg-gray-800 hover:bg-gray-700 text-gray-300 px-4 py-2 rounded-lg transition-colors flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
            Download
          </button>
        </div>
      </div>

      <!-- Data Cards Container -->
      <div id="dataCards" class="space-y-4 mb-6"></div>

      <!-- Raw JSON Toggle -->
      <div class="glass-card rounded-2xl overflow-hidden">
        <button id="toggleRawJson" class="w-full flex items-center justify-between px-5 py-3 hover:bg-gray-800/50 transition-colors">
          <span class="text-sm font-medium text-gray-400">View Raw JSON</span>
          <svg id="rawJsonChevron" class="w-4 h-4 text-gray-500 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div id="rawJsonContent" class="collapsible-content">
          <pre id="jsonOutput" class="p-5 text-sm leading-relaxed overflow-x-auto bg-gray-950 max-h-[500px] overflow-y-auto border-t border-gray-800"></pre>
        </div>
      </div>

      <!-- Generate Portfolio CTA -->
      <div class="mt-6 flex justify-center">
        <button
          id="goToPortfolioBtn"
          class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-semibold px-8 py-3 rounded-xl text-sm transition-all shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40 flex items-center gap-2"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
          Generate Portfolio
        </button>
      </div>
    </section>

    <!-- ================================================================== -->
    <!-- STEP 3: PORTFOLIO SECTION -->
    <!-- ================================================================== -->
    <section id="portfolioSection" class="section-fade hidden-section">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-2xl font-bold text-white">Generate Portfolio</h2>
          <p class="text-gray-400 text-sm mt-1">Choose a template and create your portfolio website</p>
        </div>
        <button id="backToResults" class="text-sm text-gray-400 hover:text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors flex items-center gap-1">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          Back
        </button>
      </div>

      <!-- Template Selection -->
      <div class="glass-card rounded-2xl p-6 mb-6">
        <h3 class="text-sm font-medium text-gray-300 mb-4">Choose a Template</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <label class="relative cursor-pointer">
            <input type="radio" name="template" value="minimalist" checked class="peer sr-only" />
            <div class="border-2 border-gray-700 peer-checked:border-indigo-500 peer-checked:bg-indigo-500/5 rounded-xl p-4 transition-all hover:border-gray-600">
              <div class="flex items-center gap-3">
                <span class="text-2xl">ðŸ–¤</span>
                <div>
                  <p class="text-sm font-medium text-white">Minimalist</p>
                  <p class="text-xs text-gray-500">Dark, clean, modern â€” Inter font, smooth animations</p>
                </div>
              </div>
            </div>
          </label>
        </div>
        <div class="flex justify-end mt-5">
          <button
            id="generateWebsiteBtn"
            class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-semibold px-6 py-2.5 rounded-xl text-sm transition-all shadow-lg shadow-indigo-500/25 flex items-center gap-2"
          >
            <span id="genLabel">Generate Website</span>
            <div id="genSpinner" class="spinner hidden"></div>
          </button>
        </div>
      </div>

      <!-- Preview & Download -->
      <div id="previewPanel" class="hidden space-y-4">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-gray-300">Portfolio Preview</h3>
          <button
            id="downloadPortfolioBtn"
            class="bg-green-600 hover:bg-green-500 active:bg-green-700 text-white font-medium px-5 py-2 rounded-xl text-sm transition-colors flex items-center gap-2"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
            Download Portfolio HTML
          </button>
        </div>
        <div class="rounded-2xl overflow-hidden border border-gray-700 bg-white shadow-2xl">
          <iframe id="portfolioPreview" class="w-full" style="height:600px;" sandbox="allow-scripts"></iframe>
        </div>
      </div>
    </section>

  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="text-center text-xs text-gray-600 py-8 border-t border-gray-800/30 mt-12">
    R2P â€” Resume to Portfolio &middot; No data leaves your browser (unless using LLM mode)
  </footer>

  <!-- ================================================================== -->
  <!-- ===== JAVASCRIPT ===== -->
  <!-- ================================================================== -->
  <script>
  (function () {
    "use strict";

    // Configure pdf.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

    // ----- DOM refs -----
    const apiKeyInput    = document.getElementById("apiKey");
    const toggleKeyBtn   = document.getElementById("toggleKey");
    const modeIndicator  = document.getElementById("modeIndicator");
    const resumeTextarea = document.getElementById("resumeText");
    const extractBtn     = document.getElementById("extractBtn");
    const extractLabel   = document.getElementById("extractLabel");
    const extractSpinner = document.getElementById("extractSpinner");
    const statusMsg      = document.getElementById("statusMsg");
    const resultsSection = document.getElementById("resultsSection");
    const jsonOutput     = document.getElementById("jsonOutput");
    const copyBtn        = document.getElementById("copyBtn");
    const downloadBtn    = document.getElementById("downloadBtn");
    const dataCards      = document.getElementById("dataCards");

    // Upload DOM refs
    const dropZone       = document.getElementById("dropZone");
    const dropZoneContent = document.getElementById("dropZoneContent");
    const fileInfo       = document.getElementById("fileInfo");
    const fileNameEl     = document.getElementById("fileName");
    const fileSizeEl     = document.getElementById("fileSize");
    const removeFileBtn  = document.getElementById("removeFile");
    const pdfLoading     = document.getElementById("pdfLoading");
    const fileInput      = document.getElementById("fileInput");

    // Settings DOM refs
    const settingsBtn    = document.getElementById("settingsBtn");
    const settingsPanel  = document.getElementById("settingsPanel");
    const settingsOverlay = document.getElementById("settingsOverlay");
    const closeSettings  = document.getElementById("closeSettings");

    // Section refs
    const uploadSection  = document.getElementById("uploadSection");
    const portfolioSection = document.getElementById("portfolioSection");

    // Step refs
    const step1 = document.getElementById("step1");
    const step2 = document.getElementById("step2");
    const step3 = document.getElementById("step3");
    const connector1 = document.getElementById("connector1");
    const connector2 = document.getElementById("connector2");

    // Navigation refs
    const backToUpload   = document.getElementById("backToUpload");
    const backToResults  = document.getElementById("backToResults");
    const goToPortfolioBtn = document.getElementById("goToPortfolioBtn");

    // Phase 2 DOM refs
    const generateWebsiteBtn   = document.getElementById("generateWebsiteBtn");
    const genLabel             = document.getElementById("genLabel");
    const genSpinner           = document.getElementById("genSpinner");
    const previewPanel         = document.getElementById("previewPanel");
    const portfolioPreview     = document.getElementById("portfolioPreview");
    const downloadPortfolioBtn = document.getElementById("downloadPortfolioBtn");

    // Raw JSON toggle
    const toggleRawJson  = document.getElementById("toggleRawJson");
    const rawJsonContent = document.getElementById("rawJsonContent");
    const rawJsonChevron = document.getElementById("rawJsonChevron");

    let extractedJSON = null;
    let generatedHTML = null;
    let selectedFile = null;

    // ================================================================
    // SETTINGS PANEL
    // ================================================================
    settingsBtn.addEventListener("click", () => settingsPanel.classList.remove("hidden"));
    closeSettings.addEventListener("click", () => settingsPanel.classList.add("hidden"));
    settingsOverlay.addEventListener("click", () => settingsPanel.classList.add("hidden"));

    // ----- API key persistence (sessionStorage) -----
    const STORAGE_KEY = "r2p_openai_key";
    const savedKey = sessionStorage.getItem(STORAGE_KEY);
    if (savedKey) {
      apiKeyInput.value = savedKey;
      updateModeIndicator();
    }

    apiKeyInput.addEventListener("input", () => {
      const key = apiKeyInput.value.trim();
      if (key) sessionStorage.setItem(STORAGE_KEY, key);
      else sessionStorage.removeItem(STORAGE_KEY);
      updateModeIndicator();
    });

    function updateModeIndicator() {
      const hasKey = apiKeyInput.value.trim().length > 0;
      modeIndicator.innerHTML = hasKey
        ? 'Mode: <span class="text-green-400 font-medium">LLM (OpenAI GPT-3.5-turbo)</span>'
        : 'Mode: <span class="text-amber-400 font-medium">Regex/Heuristic fallback</span>';
    }

    toggleKeyBtn.addEventListener("click", () => {
      const isPassword = apiKeyInput.type === "password";
      apiKeyInput.type = isPassword ? "text" : "password";
      toggleKeyBtn.textContent = isPassword ? "Hide" : "Show";
    });

    // ================================================================
    // NAVIGATION / STEP MANAGEMENT
    // ================================================================
    function setStep(stepNum) {
      const steps = [step1, step2, step3];
      const connectors = [connector1, connector2];
      const sections = [uploadSection, resultsSection, portfolioSection];

      steps.forEach((s, i) => {
        const num = i + 1;
        s.className = "step-item " + (num < stepNum ? "completed" : num === stepNum ? "active" : "pending");
        const label = s.querySelector("span");
        if (label) label.className = "text-sm font-medium hidden sm:inline " + (num <= stepNum ? "text-white" : "text-gray-500");
      });

      connectors.forEach((c, i) => {
        c.className = "step-connector mx-3" + (i + 1 < stepNum ? " completed" : "");
      });

      sections.forEach((sec, i) => {
        const num = i + 1;
        if (num === stepNum) {
          sec.classList.remove("hidden-section");
          sec.classList.remove("hidden");
        } else {
          sec.classList.add("hidden-section");
        }
      });

      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    backToUpload.addEventListener("click", () => setStep(1));
    backToResults.addEventListener("click", () => setStep(2));
    goToPortfolioBtn.addEventListener("click", () => {
      setStep(3);
      previewPanel.classList.add("hidden");
      genLabel.textContent = "Generate Website";
      generateWebsiteBtn.disabled = false;
    });

    // ================================================================
    // PDF UPLOAD / DRAG & DROP
    // ================================================================
    dropZone.addEventListener("click", (e) => {
      if (e.target.closest("#removeFile")) return;
      if (!selectedFile) fileInput.click();
    });

    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("drag-over");
    });

    dropZone.addEventListener("dragleave", (e) => {
      e.preventDefault();
      dropZone.classList.remove("drag-over");
    });

    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("drag-over");
      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type === "application/pdf") {
        handleFileSelect(files[0]);
      } else {
        showStatus("error", "Please drop a PDF file.");
      }
    });

    fileInput.addEventListener("change", (e) => {
      if (e.target.files.length > 0) {
        handleFileSelect(e.target.files[0]);
      }
    });

    removeFileBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      selectedFile = null;
      fileInput.value = "";
      dropZoneContent.classList.remove("hidden");
      fileInfo.classList.add("hidden");
      resumeTextarea.value = "";
    });

    function handleFileSelect(file) {
      if (file.size > 10 * 1024 * 1024) {
        showStatus("error", "File too large. Maximum size is 10MB.");
        return;
      }
      selectedFile = file;
      fileNameEl.textContent = file.name;
      fileSizeEl.textContent = formatFileSize(file.size);
      dropZoneContent.classList.add("hidden");
      fileInfo.classList.remove("hidden");
      pdfLoading.classList.add("hidden");

      // Auto-extract text from PDF
      extractPDFText(file);
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + " B";
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
      return (bytes / (1024 * 1024)).toFixed(1) + " MB";
    }

    async function extractPDFText(file) {
      fileInfo.classList.add("hidden");
      pdfLoading.classList.remove("hidden");

      try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let fullText = "";

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(item => item.str).join(" ");
          fullText += pageText + "\n";
        }

        resumeTextarea.value = fullText.trim();
        pdfLoading.classList.add("hidden");
        fileInfo.classList.remove("hidden");
        showStatus("success", "âœ“ PDF text extracted successfully. Click 'Extract Resume Data' to parse it.");
      } catch (err) {
        pdfLoading.classList.add("hidden");
        dropZoneContent.classList.remove("hidden");
        selectedFile = null;
        showStatus("error", "Failed to extract text from PDF: " + err.message);
      }
    }

    // ================================================================
    // STATUS HELPERS
    // ================================================================
    function showStatus(type, message) {
      statusMsg.className = "text-sm rounded-xl px-4 py-3 mb-6 " + ({
        success: "bg-green-900/40 border border-green-700/50 text-green-300",
        error:   "bg-red-900/40 border border-red-700/50 text-red-300",
        info:    "bg-blue-900/40 border border-blue-700/50 text-blue-300",
      }[type] || "");
      statusMsg.textContent = message;
      statusMsg.classList.remove("hidden");
    }

    function hideStatus() {
      statusMsg.classList.add("hidden");
    }

    // ================================================================
    // EXTRACT BUTTON
    // ================================================================
    extractBtn.addEventListener("click", async () => {
      const text = resumeTextarea.value.trim();
      if (!text) {
        showStatus("error", "Please upload a PDF or paste your resume text first.");
        return;
      }

      hideStatus();
      setLoading(true);

      try {
        const apiKey = apiKeyInput.value.trim();
        let result;

        if (apiKey) {
          result = await extractWithLLM(text, apiKey);
        } else {
          result = extractWithHeuristics(text);
        }

        extractedJSON = result;
        renderJSON(result);
        renderDataCards(result);
        setStep(2);
        showStatus("success", apiKey
          ? "âœ“ Extracted via OpenAI GPT-3.5-turbo"
          : "âœ“ Extracted via regex/heuristic parsing (best-effort)");
      } catch (err) {
        showStatus("error", "Extraction failed: " + err.message);
      } finally {
        setLoading(false);
      }
    });

    function setLoading(on) {
      extractBtn.disabled = on;
      extractLabel.textContent = on ? "Extractingâ€¦" : "Extract Resume Data";
      extractSpinner.classList.toggle("hidden", !on);
    }

    // ================================================================
    // RAW JSON TOGGLE
    // ================================================================
    toggleRawJson.addEventListener("click", () => {
      rawJsonContent.classList.toggle("open");
      rawJsonChevron.style.transform = rawJsonContent.classList.contains("open") ? "rotate(180deg)" : "";
    });

    // ================================================================
    // DATA CARDS RENDERING
    // ================================================================
    function renderDataCards(data) {
      dataCards.innerHTML = "";
      const sections = [
        { key: "personal", title: "Personal Information", icon: "ðŸ‘¤", render: renderPersonalCard },
        { key: "summary", title: "Summary", icon: "ðŸ“", render: renderSummaryCard },
        { key: "experience", title: "Experience", icon: "ðŸ’¼", render: renderExperienceCard },
        { key: "education", title: "Education", icon: "ðŸŽ“", render: renderEducationCard },
        { key: "skills", title: "Skills", icon: "ðŸ› ", render: renderSkillsCard },
        { key: "projects", title: "Projects", icon: "ðŸš€", render: renderProjectsCard },
      ];

      sections.forEach((section, index) => {
        const value = data[section.key];
        if (!value || (Array.isArray(value) && value.length === 0) || (typeof value === "string" && !value)) return;

        const card = document.createElement("div");
        card.className = "glass-card rounded-2xl overflow-hidden card-animate";
        card.style.animationDelay = (index * 0.1) + "s";

        const header = document.createElement("button");
        header.className = "w-full flex items-center justify-between px-5 py-4 hover:bg-gray-800/30 transition-colors";
        header.innerHTML = `
          <div class="flex items-center gap-3">
            <span class="text-lg">${section.icon}</span>
            <span class="text-sm font-semibold text-white">${section.title}</span>
            ${Array.isArray(value) ? `<span class="text-xs bg-gray-800 text-gray-400 px-2 py-0.5 rounded-full">${value.length}</span>` : ""}
          </div>
          <svg class="w-4 h-4 text-gray-500 transition-transform section-chevron" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        `;

        const content = document.createElement("div");
        content.className = "collapsible-content open";
        const inner = document.createElement("div");
        inner.className = "px-5 pb-4 border-t border-gray-800/50";
        section.render(inner, value);
        content.appendChild(inner);

        header.addEventListener("click", () => {
          content.classList.toggle("open");
          header.querySelector(".section-chevron").style.transform = content.classList.contains("open") ? "" : "rotate(-90deg)";
        });

        card.appendChild(header);
        card.appendChild(content);
        dataCards.appendChild(card);
      });
    }

    function renderPersonalCard(container, personal) {
      const fields = [
        { label: "Name", key: "name" },
        { label: "Title", key: "title" },
        { label: "Email", key: "email" },
        { label: "Phone", key: "phone" },
        { label: "LinkedIn", key: "linkedin" },
        { label: "GitHub", key: "github" },
        { label: "Location", key: "location" },
      ];
      const grid = document.createElement("div");
      grid.className = "grid grid-cols-1 sm:grid-cols-2 gap-3 pt-4";
      fields.forEach(f => {
        const val = personal[f.key] || "";
        const div = document.createElement("div");
        div.innerHTML = `
          <label class="text-xs text-gray-500 block mb-1">${f.label}</label>
          <input type="text" value="${escAttr(val)}" data-section="personal" data-key="${f.key}"
            class="editable-field w-full bg-transparent text-sm text-gray-200" />
        `;
        grid.appendChild(div);
      });
      container.appendChild(grid);

      // Listen for edits
      grid.querySelectorAll("input").forEach(input => {
        input.addEventListener("change", () => {
          if (extractedJSON && extractedJSON.personal) {
            extractedJSON.personal[input.dataset.key] = input.value;
            renderJSON(extractedJSON);
          }
        });
      });
    }

    function renderSummaryCard(container, summary) {
      const div = document.createElement("div");
      div.className = "pt-4";
      div.innerHTML = `
        <textarea data-section="summary" rows="3"
          class="editable-field w-full bg-transparent text-sm text-gray-300 leading-relaxed resize-y">${escHTML(summary)}</textarea>
      `;
      div.querySelector("textarea").addEventListener("change", (e) => {
        if (extractedJSON) {
          extractedJSON.summary = e.target.value;
          renderJSON(extractedJSON);
        }
      });
      container.appendChild(div);
    }

    function renderExperienceCard(container, experience) {
      const div = document.createElement("div");
      div.className = "space-y-4 pt-4";
      experience.forEach((exp, i) => {
        const item = document.createElement("div");
        item.className = "bg-gray-800/30 rounded-xl p-4";
        item.innerHTML = `
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
            <input type="text" value="${escAttr(exp.role || "")}" data-idx="${i}" data-key="role"
              class="editable-field bg-transparent text-sm font-semibold text-white" placeholder="Role" />
            <input type="text" value="${escAttr(exp.duration || "")}" data-idx="${i}" data-key="duration"
              class="editable-field bg-transparent text-xs text-gray-400 mt-1 sm:mt-0" placeholder="Duration" />
          </div>
          <input type="text" value="${escAttr(exp.company || "")}" data-idx="${i}" data-key="company"
            class="editable-field bg-transparent text-sm text-indigo-400 mb-2 w-full" placeholder="Company" />
          <ul class="space-y-1 text-sm text-gray-400">
            ${(exp.achievements || []).map(a => `<li class="flex items-start gap-2"><span class="text-gray-600 mt-0.5">â€¢</span><span>${escHTML(a)}</span></li>`).join("")}
          </ul>
        `;
        // Edit listeners
        item.querySelectorAll("input").forEach(input => {
          input.addEventListener("change", () => {
            if (extractedJSON && extractedJSON.experience[input.dataset.idx]) {
              extractedJSON.experience[input.dataset.idx][input.dataset.key] = input.value;
              renderJSON(extractedJSON);
            }
          });
        });
        div.appendChild(item);
      });
      container.appendChild(div);
    }

    function renderEducationCard(container, education) {
      const div = document.createElement("div");
      div.className = "space-y-3 pt-4";
      education.forEach((edu, i) => {
        const item = document.createElement("div");
        item.className = "flex flex-col sm:flex-row sm:items-center sm:justify-between py-3 border-b border-gray-800/50 last:border-0";
        item.innerHTML = `
          <div class="flex-1">
            <input type="text" value="${escAttr(edu.degree || "")}" data-idx="${i}" data-key="degree"
              class="editable-field bg-transparent text-sm font-medium text-white w-full" placeholder="Degree" />
            <input type="text" value="${escAttr(edu.institution || "")}" data-idx="${i}" data-key="institution"
              class="editable-field bg-transparent text-sm text-gray-400 w-full" placeholder="Institution" />
          </div>
          <input type="text" value="${escAttr(edu.year || "")}" data-idx="${i}" data-key="year"
            class="editable-field bg-transparent text-sm text-gray-500 mt-1 sm:mt-0" placeholder="Year" />
        `;
        item.querySelectorAll("input").forEach(input => {
          input.addEventListener("change", () => {
            if (extractedJSON && extractedJSON.education[input.dataset.idx]) {
              extractedJSON.education[input.dataset.idx][input.dataset.key] = input.value;
              renderJSON(extractedJSON);
            }
          });
        });
        div.appendChild(item);
      });
      container.appendChild(div);
    }

    function renderSkillsCard(container, skills) {
      const div = document.createElement("div");
      div.className = "flex flex-wrap gap-2 pt-4";
      skills.forEach(s => {
        const tag = document.createElement("span");
        tag.className = "px-3 py-1.5 bg-gray-800/50 text-gray-300 text-sm rounded-lg border border-gray-700/50 hover:border-indigo-500/30 transition-colors";
        tag.textContent = s;
        div.appendChild(tag);
      });
      container.appendChild(div);
    }

    function renderProjectsCard(container, projects) {
      const div = document.createElement("div");
      div.className = "grid grid-cols-1 sm:grid-cols-2 gap-3 pt-4";
      projects.forEach((proj, i) => {
        const item = document.createElement("div");
        item.className = "bg-gray-800/30 rounded-xl p-4";
        const techs = (proj.technologies || []).map(t => `<span class="px-2 py-0.5 bg-gray-700/50 text-indigo-300 text-xs rounded-full">${escHTML(t)}</span>`).join("");
        item.innerHTML = `
          <input type="text" value="${escAttr(proj.name || "")}" data-idx="${i}" data-key="name"
            class="editable-field bg-transparent text-sm font-semibold text-white w-full mb-1" placeholder="Project name" />
          <p class="text-gray-400 text-xs mb-2">${escHTML(proj.description || "")}</p>
          <div class="flex flex-wrap gap-1 mb-2">${techs}</div>
          ${proj.link ? `<a href="${proj.link.startsWith("http") ? proj.link : "https://" + proj.link}" target="_blank" class="text-xs text-indigo-400 hover:text-indigo-300">View â†’</a>` : ""}
        `;
        item.querySelectorAll("input").forEach(input => {
          input.addEventListener("change", () => {
            if (extractedJSON && extractedJSON.projects[input.dataset.idx]) {
              extractedJSON.projects[input.dataset.idx][input.dataset.key] = input.value;
              renderJSON(extractedJSON);
            }
          });
        });
        div.appendChild(item);
      });
      container.appendChild(div);
    }

    function escHTML(str) {
      return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
    }

    function escAttr(str) {
      return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
    }

    // ================================================================
    // LLM EXTRACTION (OpenAI API)
    // ================================================================
    async function extractWithLLM(resumeText, apiKey) {
      const systemPrompt = `You are a resume parser. Extract structured data from the provided resume text and return ONLY valid JSON matching this exact schema (no markdown, no explanation):

{
  "personal": {
    "name": "",
    "title": "",
    "email": "",
    "phone": "",
    "linkedin": "",
    "github": "",
    "location": ""
  },
  "summary": "",
  "experience": [
    {
      "company": "",
      "role": "",
      "duration": "",
      "achievements": []
    }
  ],
  "education": [
    {
      "institution": "",
      "degree": "",
      "year": ""
    }
  ],
  "skills": [],
  "projects": [
    {
      "name": "",
      "description": "",
      "technologies": [],
      "link": ""
    }
  ]
}

Rules:
- Fill in every field you can find. Use empty string "" for missing text fields, empty array [] for missing arrays.
- "achievements" should be an array of strings (bullet points).
- "skills" should be a flat array of skill strings.
- "duration" should be the date range as written (e.g. "Jan 2021 â€“ Present").
- Return ONLY the JSON object, nothing else.`;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${apiKey}`,
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [
            { role: "system", content: systemPrompt },
            { role: "user", content: resumeText },
          ],
          temperature: 0.1,
          max_tokens: 2000,
        }),
      });

      if (!response.ok) {
        const err = await response.json().catch(() => ({}));
        throw new Error(err.error?.message || `API returned ${response.status}`);
      }

      const data = await response.json();
      const content = data.choices?.[0]?.message?.content?.trim();

      if (!content) throw new Error("Empty response from API");

      const cleaned = content.replace(/^```(?:json)?\s*/i, "").replace(/\s*```$/i, "");

      try {
        return JSON.parse(cleaned);
      } catch {
        throw new Error("API returned invalid JSON. Raw response: " + content.slice(0, 200));
      }
    }

    // ================================================================
    // HEURISTIC / REGEX EXTRACTION (fallback)
    // ================================================================
    function extractWithHeuristics(text) {
      const lines = text.split(/\n/);
      const trimmedLines = lines.map(l => l.trim()).filter(Boolean);

      const findFirst = (regex) => {
        for (const line of trimmedLines) {
          const m = line.match(regex);
          if (m) return m;
        }
        return null;
      };

      const sectionHeaders = /^(summary|objective|profile|about|experience|work\s*experience|employment|education|academic|skills|technical\s*skills|core\s*competencies|projects|certifications?|awards?|publications?|volunteer)/i;

      function getSectionContent(sectionRegex) {
        const content = [];
        let capturing = false;
        for (const line of lines) {
          const trimmed = line.trim();
          if (!trimmed) {
            if (capturing) content.push("");
            continue;
          }
          if (sectionRegex.test(trimmed)) {
            capturing = true;
            continue;
          }
          if (capturing && sectionHeaders.test(trimmed)) {
            break;
          }
          if (capturing) content.push(trimmed);
        }
        return content;
      }

      // ---- PERSONAL INFO ----
      const emailMatch  = findFirst(/[\w.+-]+@[\w-]+\.[\w.]+/);
      const phoneMatch  = findFirst(/(\+?\d[\d\s\-().]{7,}\d)/);
      const linkedinMatch = findFirst(/((?:https?:\/\/)?(?:www\.)?linkedin\.com\/in\/[\w-]+\/?)/i);
      const githubMatch = findFirst(/((?:https?:\/\/)?(?:www\.)?github\.com\/[\w-]+\/?)/i);

      let name = "";
      let title = "";
      for (const line of trimmedLines) {
        if (/[@]/.test(line)) continue;
        if (/linkedin|github|http/i.test(line)) continue;
        if (/^\+?\d[\d\s\-().]{7,}/.test(line)) continue;
        if (sectionHeaders.test(line)) break;
        if (!name) { name = line; continue; }
        if (!title && !/[|â€¢Â·,]/.test(line.charAt(0))) {
          if (/\d{3}/.test(line) || /@/.test(line)) continue;
          title = line;
          break;
        }
      }

      const locationMatch = findFirst(/([A-Z][a-zA-Z\s]+,\s*[A-Z]{2}(?:\s+\d{5})?)/);
      const location = locationMatch ? locationMatch[1] : "";

      const personal = {
        name: name,
        title: title,
        email: emailMatch ? emailMatch[0] : "",
        phone: phoneMatch ? phoneMatch[1].trim() : "",
        linkedin: linkedinMatch ? linkedinMatch[1] : "",
        github: githubMatch ? githubMatch[1] : "",
        location: location,
      };

      const summaryLines = getSectionContent(/^(summary|objective|profile|about)\s*:?\s*$/i);
      const summary = summaryLines.filter(Boolean).join(" ");

      const expLines = getSectionContent(/^(experience|work\s*experience|employment|professional\s*experience)\s*:?\s*$/i);
      const experience = parseExperience(expLines);

      const eduLines = getSectionContent(/^(education|academic)\s*:?\s*$/i);
      const education = parseEducation(eduLines);

      const skillLines = getSectionContent(/^(skills|technical\s*skills|core\s*competencies|technologies)\s*:?\s*$/i);
      const skills = parseSkills(skillLines);

      const projLines = getSectionContent(/^(projects|personal\s*projects|side\s*projects)\s*:?\s*$/i);
      const projects = parseProjects(projLines);

      return { personal, summary, experience, education, skills, projects };
    }

    function parseExperience(lines) {
      if (!lines.length) return [];

      const dateRangeRe = /(\w{3,9}\.?\s+\d{4}\s*[-â€“â€”]\s*(?:\w{3,9}\.?\s+\d{4}|present|current|now)|\d{4}\s*[-â€“â€”]\s*(?:\d{4}|present|current|now))/i;
      const bulletRe = /^[â€¢\-â€“â€”*â–ªâ–¸â–º]\s*/;

      const entries = [];
      let current = null;

      for (const line of lines) {
        if (!line) continue;

        const dateMatch = line.match(dateRangeRe);

        if (dateMatch && !bulletRe.test(line)) {
          if (current) entries.push(current);

          const cleaned = line.replace(dateRangeRe, "").replace(/[()]/g, "").trim();
          const parts = cleaned.split(/\s*[â€”â€“|@]\s*/).map(s => s.trim()).filter(Boolean);

          current = {
            company: parts[1] || parts[0] || "",
            role: parts.length > 1 ? parts[0] : "",
            duration: dateMatch[1].trim(),
            achievements: [],
          };
          continue;
        }

        if (!current && !bulletRe.test(line)) {
          const parts = line.split(/\s*[â€”â€“|@]\s*/).map(s => s.trim()).filter(Boolean);
          if (parts.length >= 1) {
            current = {
              company: parts[1] || parts[0] || "",
              role: parts.length > 1 ? parts[0] : "",
              duration: "",
              achievements: [],
            };
            continue;
          }
        }

        if (current && bulletRe.test(line)) {
          current.achievements.push(line.replace(bulletRe, "").trim());
        } else if (current && line.length > 10) {
          current.achievements.push(line);
        }
      }

      if (current) entries.push(current);
      return entries;
    }

    function parseEducation(lines) {
      if (!lines.length) return [];

      const entries = [];
      let current = null;
      const yearRe = /(\d{4})/;

      for (const line of lines) {
        if (!line) continue;

        const hasDegree = /\b(B\.?S\.?|B\.?A\.?|B\.?Tech|M\.?S\.?|M\.?A\.?|M\.?Tech|Ph\.?D|MBA|Bachelor|Master|Doctor|Associate|Diploma|Certificate)\b/i.test(line);
        const hasYear = yearRe.test(line);

        if (hasDegree || (!current && line.length > 3)) {
          if (current) entries.push(current);
          current = { institution: "", degree: "", year: "" };

          const segments = line.split(/\s*\|\s*/).map(s => s.trim()).filter(Boolean);

          if (segments.length >= 3) {
            current.degree = segments[0];
            current.institution = segments[1];
            const ym = segments[2].match(yearRe);
            current.year = ym ? ym[1] : segments[2];
          } else if (segments.length === 2) {
            const ym0 = segments[0].match(yearRe);
            const ym1 = segments[1].match(yearRe);
            if (hasDegree) {
              if (/\b(B\.?S\.?|B\.?A\.?|B\.?Tech|M\.?S\.?|M\.?A\.?|M\.?Tech|Ph\.?D|MBA|Bachelor|Master|Doctor|Associate|Diploma|Certificate)\b/i.test(segments[0])) {
                current.degree = segments[0].replace(/\s*\d{4}\s*[-â€“â€”]?\s*\d{0,4}\s*/, "").trim();
                current.institution = segments[1].replace(/\s*\d{4}\s*[-â€“â€”]?\s*\d{0,4}\s*/, "").trim();
              } else {
                current.institution = segments[0].replace(/\s*\d{4}\s*[-â€“â€”]?\s*\d{0,4}\s*/, "").trim();
                current.degree = segments[1].replace(/\s*\d{4}\s*[-â€“â€”]?\s*\d{0,4}\s*/, "").trim();
              }
            } else {
              current.institution = segments[0];
              current.degree = segments[1];
            }
            current.year = (ym1 ? ym1[1] : "") || (ym0 ? ym0[1] : "");
          } else {
            const parts = line.replace(/[()]/g, " ").replace(/\d{4}\s*[-â€“â€”]?\s*\d{0,4}/, "").trim();
            const subSegments = parts.split(/\s*[â€”â€“,]\s*/).map(s => s.trim()).filter(Boolean);
            const yearMatch = line.match(yearRe);
            current.year = yearMatch ? yearMatch[1] : "";
            if (hasDegree) {
              current.degree = subSegments[0] || "";
              current.institution = subSegments.slice(1).join(", ");
            } else {
              current.institution = subSegments[0] || line;
            }
          }
          continue;
        }

        if (current) {
          if (!current.institution && !hasDegree) current.institution = line;
          else if (!current.degree) current.degree = line;
          if (hasYear && !current.year) current.year = line.match(yearRe)[1];
        }
      }

      if (current) entries.push(current);
      return entries;
    }

    function parseSkills(lines) {
      if (!lines.length) return [];
      const text = lines.join(" ");
      const cleaned = text.replace(/[A-Za-z\s]+:/g, ",");
      return cleaned
        .split(/[,;|â€¢Â·â–ªâ–º]\s*/)
        .map(s => s.replace(/^[\-â€“â€”*\s]+/, "").trim())
        .filter(s => s.length > 0 && s.length < 60);
    }

    function parseProjects(lines) {
      if (!lines.length) return [];

      const bulletRe = /^[â€¢\-â€“â€”*â–ªâ–¸â–º]\s*/;
      const urlRe = /((?:https?:\/\/)?(?:www\.)?(?:github\.com|gitlab\.com|bitbucket\.org)\/[^\s)]+|https?:\/\/[^\s)]+)/;
      const metaLineRe = /^(Tech\s*Stack|Technologies|GitHub|Link|Features|Built\s*with|URL|Demo|Live|Source)\s*:/i;
      const entries = [];
      let current = null;

      for (const line of lines) {
        if (!line) continue;

        if (current) {
          const clean = line.replace(bulletRe, "").trim();

          if (/^(Tech\s*Stack|Technologies|Built\s*with)\s*:/i.test(clean)) {
            const techs = clean.replace(/^[^:]+:\s*/, "").split(/[,;|]/).map(s => s.trim()).filter(Boolean);
            current.technologies.push(...techs);
            continue;
          }

          if (/^(GitHub|Link|URL|Demo|Live|Source)\s*:/i.test(clean)) {
            const urlMatch = clean.replace(/^[^:]+:\s*/, "").trim();
            if (urlMatch && !current.link) current.link = urlMatch;
            continue;
          }

          const bareUrl = clean.match(urlRe);
          if (bareUrl && clean === bareUrl[0]) {
            if (!current.link) current.link = bareUrl[0];
            continue;
          }

          if (/^Features\s*:/i.test(clean)) {
            current.description += (current.description ? " " : "") + clean;
            continue;
          }

          if (bulletRe.test(line) || line.length >= 80) {
            current.description += (current.description ? " " : "") + clean;
            continue;
          }
        }

        if (!bulletRe.test(line) && !metaLineRe.test(line) && line.length < 80) {
          if (current) entries.push(current);
          const urlMatch = line.match(urlRe);
          const name = line.replace(urlRe, "").replace(/[â€”â€“|]/g, " ").trim();
          current = {
            name: name,
            description: "",
            technologies: [],
            link: urlMatch ? urlMatch[1] : "",
          };
          continue;
        }

        if (current) {
          const clean = line.replace(bulletRe, "").trim();
          current.description += (current.description ? " " : "") + clean;
        }
      }

      if (current) entries.push(current);
      return entries;
    }

    // ================================================================
    // JSON RENDERING with syntax highlighting
    // ================================================================
    function renderJSON(obj) {
      const raw = JSON.stringify(obj, null, 2);
      const highlighted = raw
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"([^"]+)"(?=\s*:)/g, '<span class="json-key">"$1"</span>')
        .replace(/:\s*"([^"]*)"/g, ': <span class="json-string">"$1"</span>')
        .replace(/:\s*(\d+)/g, ': <span class="json-number">$1</span>')
        .replace(/:\s*(true|false)/g, ': <span class="json-boolean">$1</span>')
        .replace(/:\s*(null)/g, ': <span class="json-null">$1</span>')
        .replace(/([[\]{}])/g, '<span class="json-bracket">$1</span>');

      jsonOutput.innerHTML = highlighted;
    }

    // ================================================================
    // COPY & DOWNLOAD
    // ================================================================
    copyBtn.addEventListener("click", () => {
      if (!extractedJSON) return;
      const text = JSON.stringify(extractedJSON, null, 2);
      navigator.clipboard.writeText(text).then(() => {
        const orig = copyBtn.innerHTML;
        copyBtn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg> Copied!';
        setTimeout(() => { copyBtn.innerHTML = orig; }, 1500);
      });
    });

    downloadBtn.addEventListener("click", () => {
      if (!extractedJSON) return;
      const text = JSON.stringify(extractedJSON, null, 2);
      const blob = new Blob([text], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "resume.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // ================================================================
    // PHASE 2: PORTFOLIO GENERATION
    // ================================================================
    generateWebsiteBtn.addEventListener("click", () => {
      if (!extractedJSON) return;
      genLabel.textContent = "Generatingâ€¦";
      genSpinner.classList.remove("hidden");
      generateWebsiteBtn.disabled = true;

      setTimeout(() => {
        try {
          generatedHTML = generateMinimalistPortfolio(extractedJSON);
          portfolioPreview.srcdoc = generatedHTML;
          previewPanel.classList.remove("hidden");
          genLabel.textContent = "âœ“ Generated!";
          genSpinner.classList.add("hidden");
          previewPanel.scrollIntoView({ behavior: "smooth", block: "start" });
        } catch (err) {
          showStatus("error", "Portfolio generation failed: " + err.message);
          genLabel.textContent = "Generate Website";
          genSpinner.classList.add("hidden");
          generateWebsiteBtn.disabled = false;
        }
      }, 100);
    });

    downloadPortfolioBtn.addEventListener("click", () => {
      if (!generatedHTML) return;
      const blob = new Blob([generatedHTML], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "portfolio.html";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // ================================================================
    // MINIMALIST PORTFOLIO TEMPLATE
    // ================================================================
    function generateMinimalistPortfolio(data) {
      const p = data.personal || {};
      const name = escHTML(p.name || "Your Name");
      const title = escHTML(p.title || "Professional");
      const email = p.email || "";
      const linkedin = p.linkedin || "";
      const github = p.github || "";
      const location = escHTML(p.location || "");
      const summary = escHTML(data.summary || "");
      const experience = data.experience || [];
      const education = data.education || [];
      const skills = data.skills || [];
      const projects = data.projects || [];

      function makeLink(url) {
        if (!url) return "";
        const href = url.startsWith("http") ? url : "https://" + url;
        return href;
      }

      let socialHTML = "";
      if (email) socialHTML += `<a href="mailto:${escHTML(email)}" class="text-gray-400 hover:text-blue-400 transition-colors"><svg class="w-5 h-5 inline" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg> <span class="ml-1">${escHTML(email)}</span></a>`;
      if (linkedin) socialHTML += `<a href="${makeLink(linkedin)}" target="_blank" class="text-gray-400 hover:text-blue-400 transition-colors"><svg class="w-5 h-5 inline" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg> <span class="ml-1">LinkedIn</span></a>`;
      if (github) socialHTML += `<a href="${makeLink(github)}" target="_blank" class="text-gray-400 hover:text-blue-400 transition-colors"><svg class="w-5 h-5 inline" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg> <span class="ml-1">GitHub</span></a>`;

      let expHTML = "";
      experience.forEach(exp => {
        const achievements = (exp.achievements || []).map(a => `<li class="text-gray-400 text-sm leading-relaxed">${escHTML(a)}</li>`).join("");
        expHTML += `
          <div class="fade-in relative pl-8 pb-10 border-l-2 border-gray-800 last:pb-0">
            <div class="absolute left-[-9px] top-0 w-4 h-4 rounded-full bg-blue-500 border-4 border-gray-950"></div>
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-1">
              <h3 class="text-lg font-semibold text-white">${escHTML(exp.role || "")}</h3>
              <span class="text-sm text-gray-500">${escHTML(exp.duration || "")}</span>
            </div>
            <p class="text-blue-400 text-sm mb-3">${escHTML(exp.company || "")}</p>
            ${achievements ? `<ul class="space-y-1.5 list-disc list-inside">${achievements}</ul>` : ""}
          </div>`;
      });

      let projHTML = "";
      projects.forEach(proj => {
        const techs = (proj.technologies || []).map(t => `<span class="px-2 py-1 bg-gray-800 text-blue-400 text-xs rounded-full">${escHTML(t)}</span>`).join("");
        const linkBtn = proj.link ? `<a href="${makeLink(proj.link)}" target="_blank" class="inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors mt-3">View Project <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg></a>` : "";
        projHTML += `
          <div class="fade-in bg-gray-900/50 border border-gray-800 rounded-xl p-6 hover:border-gray-700 transition-colors">
            <h3 class="text-lg font-semibold text-white mb-2">${escHTML(proj.name || "")}</h3>
            <p class="text-gray-400 text-sm mb-4">${escHTML(proj.description || "")}</p>
            <div class="flex flex-wrap gap-2">${techs}</div>
            ${linkBtn}
          </div>`;
      });

      const skillsHTML = skills.map(s => `<span class="fade-in px-4 py-2 bg-gray-900/50 border border-gray-800 text-gray-300 text-sm rounded-full hover:border-blue-500/50 transition-colors">${escHTML(s)}</span>`).join("");

      let eduHTML = "";
      education.forEach(edu => {
        eduHTML += `
          <div class="fade-in flex flex-col sm:flex-row sm:items-center sm:justify-between py-4 border-b border-gray-800 last:border-0">
            <div>
              <h3 class="text-white font-medium">${escHTML(edu.degree || "")}</h3>
              <p class="text-gray-400 text-sm">${escHTML(edu.institution || "")}</p>
            </div>
            <span class="text-gray-500 text-sm mt-1 sm:mt-0">${escHTML(edu.year || "")}</span>
          </div>`;
      });

      return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${name} â€” Portfolio</title>
  <script src="https://cdn.tailwindcss.com"><\/script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    html { scroll-behavior: smooth; }
    body { background: #0a0a0a; color: #fff; }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    .fade-in.visible {
      opacity: 1;
      transform: translateY(0);
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
  </style>
</head>
<body class="antialiased">

  <!-- Navigation -->
  <nav class="fixed top-0 w-full bg-[#0a0a0a]/80 backdrop-blur-lg border-b border-gray-800/50 z-50">
    <div class="max-w-5xl mx-auto px-6 py-4 flex items-center justify-between">
      <a href="#hero" class="text-lg font-bold text-white">${name.split(" ")[0]}<span class="text-blue-500">.</span></a>
      <div class="hidden sm:flex items-center gap-8">
        ${experience.length ? '<a href="#experience" class="text-sm text-gray-400 hover:text-white transition-colors">Experience</a>' : ""}
        ${projects.length ? '<a href="#projects" class="text-sm text-gray-400 hover:text-white transition-colors">Projects</a>' : ""}
        ${skills.length ? '<a href="#skills" class="text-sm text-gray-400 hover:text-white transition-colors">Skills</a>' : ""}
        ${education.length ? '<a href="#education" class="text-sm text-gray-400 hover:text-white transition-colors">Education</a>' : ""}
      </div>
    </div>
  </nav>

  <main class="max-w-5xl mx-auto px-6">

    <!-- Hero -->
    <section id="hero" class="min-h-screen flex flex-col justify-center py-20 pt-32">
      <div class="fade-in">
        <p class="text-blue-500 text-sm font-medium tracking-wider uppercase mb-4">Hello, I'm</p>
        <h1 class="text-5xl sm:text-7xl font-extrabold text-white leading-tight mb-4">${name}</h1>
        <h2 class="text-2xl sm:text-3xl font-light text-gray-400 mb-6">${title}</h2>
        ${summary ? `<p class="text-gray-500 text-lg max-w-2xl leading-relaxed mb-8">${escHTML(summary)}</p>` : ""}
        ${location ? `<p class="text-gray-600 text-sm mb-6">ðŸ“ ${location}</p>` : ""}
        <div class="flex flex-wrap items-center gap-6">
          ${socialHTML}
        </div>
      </div>
    </section>

    ${experience.length ? `
    <!-- Experience -->
    <section id="experience" class="py-20">
      <h2 class="fade-in text-3xl font-bold text-white mb-12">Experience</h2>
      <div class="space-y-0">
        ${expHTML}
      </div>
    </section>` : ""}

    ${projects.length ? `
    <!-- Projects -->
    <section id="projects" class="py-20">
      <h2 class="fade-in text-3xl font-bold text-white mb-12">Projects</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        ${projHTML}
      </div>
    </section>` : ""}

    ${skills.length ? `
    <!-- Skills -->
    <section id="skills" class="py-20">
      <h2 class="fade-in text-3xl font-bold text-white mb-12">Skills</h2>
      <div class="flex flex-wrap gap-3">
        ${skillsHTML}
      </div>
    </section>` : ""}

    ${education.length ? `
    <!-- Education -->
    <section id="education" class="py-20">
      <h2 class="fade-in text-3xl font-bold text-white mb-12">Education</h2>
      <div class="bg-gray-900/30 border border-gray-800 rounded-xl p-6">
        ${eduHTML}
      </div>
    </section>` : ""}

  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-800/50 py-8 text-center">
    <p class="text-gray-600 text-sm">&copy; ${new Date().getFullYear()} ${name}. Built with R2P.</p>
  </footer>

  <script>
    // Intersection Observer for fade-in animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
  <\/script>
</body>
</html>`;
    }

  })();
  </script>
</body>
</html>
